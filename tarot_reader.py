import random
import json
import os
from openrouter_client import call_llm
from datetime import datetime
from typing import List, Dict, Optional
from dataclasses import dataclass, asdict
from enum import Enum

class Suit(Enum):
    MAJOR_ARCANA = "å¤§é˜¿å¡çº³"
    WANDS = "æƒæ–"
    CUPS = "åœ£æ¯"
    SWORDS = "å®å‰‘"
    PENTACLES = "æ˜Ÿå¸"

@dataclass
class TarotCard:
    name: str
    suit: Suit
    number: Optional[int]
    keywords: List[str]
    upright_meaning: str
    reversed_meaning: str
    description: str

class TarotDeck:
    def __init__(self):
        self.cards = self._create_deck()
        self.shuffled_deck = self.cards.copy()
        self.shuffle()
    
    def _create_deck(self) -> List[TarotCard]:
        """åˆ›å»ºå®Œæ•´çš„78å¼ å¡”ç½—ç‰Œ"""
        cards = []
        
        # å¤§é˜¿å¡çº³ (22å¼ )
        major_arcana = [
            ("æ„šè€…", ["æ–°å¼€å§‹", "å†’é™©", "çº¯çœŸ", "è‡ªå‘æ€§", "æ— é™å¯èƒ½"], 
             "ä»£è¡¨æ–°çš„å¼€å§‹ï¼Œå……æ»¡æ— é™å¯èƒ½æ€§ã€‚é¼“åŠ±ä»¥çº¯çœŸã€å¼€æ”¾çš„å¿ƒæ€å»æ¢ç´¢æœªçŸ¥ï¼Œå‹‡æ•¢åœ°è¸ä¸Šæ–°çš„æ—…ç¨‹ã€‚åœ¨çˆ±æƒ…ä¸­ï¼Œå¯èƒ½é¢„ç¤ºç€ä¸€æ®µè½»æ¾ã€æ— æ‹˜æ— æŸçš„æ–°å…³ç³»ã€‚åœ¨äº‹ä¸šä¸Šï¼Œæ˜¯å°è¯•æ–°é¡¹ç›®æˆ–è½¬æ¢è·‘é“çš„å¥½æ—¶æœºã€‚", 
             "ä»£è¡¨é²è½ã€è½»ç‡çš„è¡ŒåŠ¨ï¼Œç¼ºä¹è®¡åˆ’å’Œè¿œè§ã€‚å¯èƒ½å› ä¸ºè¿‡äºå†²åŠ¨è€Œå¿½è§†äº†æ½œåœ¨çš„é£é™©ï¼Œæˆ–åœ¨é€ƒé¿è´£ä»»ã€‚å»ºè®®åœ¨è¡ŒåŠ¨å‰ä¸‰æ€ï¼Œå¹¶å¯¹è‡ªå·±çš„é€‰æ‹©è´Ÿè´£ã€‚"),
            
            ("é­”æœ¯å¸ˆ", ["æ„å¿—åŠ›", "åˆ›é€ ", "æ˜¾åŒ–", "æŠ€èƒ½", "ä¸“æ³¨"], 
             "ä»£è¡¨å¼ºå¤§çš„æ„å¿—åŠ›å’Œåˆ›é€ åŠ›ï¼Œèƒ½å¤Ÿå°†æƒ³æ³•è½¬åŒ–ä¸ºç°å®ã€‚æ‹¥æœ‰å®ç°ç›®æ ‡æ‰€éœ€çš„æ‰€æœ‰å·¥å…·å’ŒæŠ€èƒ½ã€‚åœ¨äº‹ä¸šä¸Šï¼Œè¡¨ç¤ºèƒ½å¤ŸæŒæ§å±€é¢ï¼Œå‘æŒ¥æ‰èƒ½ã€‚åœ¨ä¸ªäººæˆé•¿ä¸­ï¼Œæ˜¯å­¦ä¹ æ–°æŠ€èƒ½ã€å®ç°æ½œèƒ½çš„ç»ä½³æ—¶æœºã€‚", 
             "ä»£è¡¨æ»¥ç”¨èƒ½åŠ›ã€æ“æ§ä»–äººæˆ–æ¬ºéª—ã€‚å¯èƒ½è¡¨ç¤ºæŠ€èƒ½ä¸è¶³å´å¤¸å¤§å…¶è¯ï¼Œæˆ–å°†æ‰æ™ºç”¨äºä¸æ­£å½“çš„ç›®çš„ã€‚éœ€è¦è­¦æƒ•è¢«è¡¨è±¡è¿·æƒ‘ï¼Œæˆ–è‡ªå·±é™·å…¥è‡ªæ¬ºæ¬ºäººçš„å¢ƒåœ°ã€‚"),
            
            ("å¥³ç¥­å¸", ["ç›´è§‰", "ç¥ç§˜", "æ½œæ„è¯†", "å†…åœ¨æ™ºæ…§", "ç§˜å¯†"], 
             "ä»£è¡¨ç›´è§‰ã€æ½œæ„è¯†å’Œå†…åœ¨çš„æ™ºæ…§ã€‚é¼“åŠ±å‘å†…æ¢ç´¢ï¼Œå€¾å¬è‡ªå·±å†…å¿ƒçš„å£°éŸ³ã€‚æœ‰äº›äº‹æƒ…éœ€è¦é™å¾…æ—¶æœºï¼Œä¸èƒ½å¼ºæ±‚ã€‚åœ¨äººé™…å…³ç³»ä¸­ï¼Œè¡¨ç¤ºéœ€è¦æ›´æ·±çš„ç†è§£å’Œæ´å¯ŸåŠ›ã€‚åœ¨å†³ç­–æ—¶ï¼Œåº”ç›¸ä¿¡è‡ªå·±çš„ç›´è§‰ã€‚", 
             "ä»£è¡¨å¿½è§†ç›´è§‰ã€å‹æŠ‘æƒ…æ„Ÿæˆ–ä¸å†…å¿ƒå¤±å»è¿æ¥ã€‚å¯èƒ½å› ä¸ºè¿‡åº¦ä¾èµ–é€»è¾‘åˆ†æè€Œå¿½ç•¥äº†é‡è¦çš„æ„Ÿå—ã€‚ä¹Ÿå¯èƒ½è¡¨ç¤ºæœ‰ç§˜å¯†è¢«æ­éœ²ï¼Œæˆ–å¯¹æƒ…å†µæœ‰é”™è¯¯çš„åˆ¤æ–­ã€‚"),
            
            ("çš‡å", ["ä¸°é¥¶", "æ¯æ€§", "åˆ›é€ åŠ›", "nourishingèƒ½é‡", "æ„Ÿæ€§"], 
             "ä»£è¡¨ä¸°æ”¶ã€å¯Œè¶³å’Œåˆ›é€ åŠ›ã€‚è±¡å¾ç€æ¯æ€§çš„nourishingèƒ½é‡ï¼Œæ— è®ºæ˜¯åˆ›é€ ç”Ÿå‘½ã€è‰ºæœ¯è¿˜æ˜¯é¡¹ç›®ï¼Œéƒ½èƒ½èŒå£®æˆé•¿ã€‚åœ¨çˆ±æƒ…ä¸­ï¼Œè¡¨ç¤ºå……æ»¡çˆ±ä¸å…³æ€€çš„å…³ç³»ã€‚åœ¨ç”Ÿæ´»ä¸­ï¼Œæ˜¯äº«å—æ„Ÿå®˜æ„‰æ‚¦å’Œç‰©è´¨èˆ’é€‚çš„æ—¶åˆ»ã€‚", 
             "ä»£è¡¨åˆ›é€ åŠ›å—é˜»ã€è¿‡åº¦ä¾èµ–æˆ–æƒ…æ„Ÿä¸Šçš„çª’æ¯ã€‚å¯èƒ½è¡¨ç¤ºåœ¨å…³ç³»ä¸­è¿‡åº¦ä»˜å‡ºè€Œå¤±å»è‡ªæˆ‘ï¼Œæˆ–åœ¨ç‰©è´¨ä¸Šè¿‡äºæ”¾çºµã€‚éœ€è¦å…³æ³¨è‡ªæˆ‘ç…§é¡¾ï¼Œå¹¶ä¸ºè‡ªå·±çš„åˆ›é€ åŠ›æ‰¾åˆ°å¥åº·çš„å‡ºå£ã€‚"),
            
            ("çš‡å¸", ["æƒå¨", "ç»“æ„", "æ§åˆ¶", "é¢†å¯¼åŠ›", "ç¨³å®š"], 
             "ä»£è¡¨æƒå¨ã€ç§©åºå’Œé¢†å¯¼åŠ›ã€‚è±¡å¾ç€é€šè¿‡å»ºç«‹è§„åˆ™å’Œç»“æ„æ¥å®ç°ç¨³å®šå’ŒæˆåŠŸã€‚åœ¨äº‹ä¸šä¸Šï¼Œè¡¨ç¤ºå¼ºå¤§çš„é¢†å¯¼èƒ½åŠ›å’Œç»„ç»‡èƒ½åŠ›ã€‚åœ¨ä¸ªäººç”Ÿæ´»ä¸­ï¼Œéœ€è¦è‡ªå¾‹å’Œè´£ä»»æ„Ÿæ¥è¾¾æˆç›®æ ‡ã€‚", 
             "ä»£è¡¨ä¸“åˆ¶ã€è¿‡åº¦æ§åˆ¶æˆ–ç¼ºä¹å¼¹æ€§ã€‚å¯èƒ½å› ä¸ºè¿‡äºåƒµåŒ–è€Œå‹æŠ‘äº†ä»–äººçš„åˆ›é€ åŠ›ï¼Œæˆ–åœ¨å…³ç³»ä¸­è¡¨ç°å‡ºå¼ºçƒˆçš„æ§åˆ¶æ¬²ã€‚éœ€è¦å­¦ä¼šæ”¾æ‰‹ï¼Œå¹¶ä»¥æ›´çµæ´»çš„æ–¹å¼è¡Œä½¿æƒåŠ›ã€‚"),
            
            ("æ•™çš‡", ["ä¼ ç»Ÿ", "ä¿¡ä»°", "ç²¾ç¥æŒ‡å¯¼", "å­¦ä¹ ", "å½’å±æ„Ÿ"], 
             "ä»£è¡¨ä¼ ç»Ÿã€ä¿¡ä»°å’Œç²¾ç¥æŒ‡å¯¼ã€‚é¼“åŠ±éµå¾ªæ—¢å®šçš„è§„åˆ™å’Œä¼ ç»Ÿæ™ºæ…§ï¼Œå‘æœ‰ç»éªŒçš„å¯¼å¸ˆå­¦ä¹ ã€‚åœ¨å›¢ä½“ä¸­èƒ½æ‰¾åˆ°å½’å±æ„Ÿã€‚åœ¨äººç”Ÿé“è·¯ä¸Šï¼Œæ˜¯å¯»æ±‚ç²¾ç¥æ…°è—‰å’Œé“å¾·æŒ‡å¼•çš„æ—¶åˆ»ã€‚", 
             "ä»£è¡¨æŒ‘æˆ˜ä¼ ç»Ÿã€æ€æƒ³åƒµåŒ–æˆ–æ•™æ¡ä¸»ä¹‰ã€‚å¯èƒ½å› ä¸ºå¢¨å®ˆæˆè§„è€Œæ‹’ç»æ–°çš„å¯èƒ½æ€§ï¼Œæˆ–ç›²ç›®éµä»æƒå¨è€Œå¤±å»ç‹¬ç«‹æ€è€ƒã€‚éœ€è¦è´¨ç–‘æ—¢æœ‰ä¿¡å¿µï¼Œæ‰¾åˆ°é€‚åˆè‡ªå·±çš„çœŸç†ã€‚"),
            
            ("æ‹äºº", ["é€‰æ‹©", "å…³ç³»", "å’Œè°", "ç»“åˆ", "ä»·å€¼è§‚"], 
             "ä»£è¡¨é‡è¦çš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯åœ¨å…³ç³»å’Œä»·å€¼è§‚æ–¹é¢ã€‚è±¡å¾ç€å’Œè°çš„ç»“åˆä¸æ·±å±‚çš„æƒ…æ„Ÿè¿æ¥ã€‚åœ¨çˆ±æƒ…ä¸­ï¼Œé¢„ç¤ºç€ä¸€æ®µé‡è¦çš„å…³ç³»æˆ–æ‰¿è¯ºã€‚åœ¨å†³ç­–æ—¶ï¼Œéœ€è¦éµå¾ªå†…å¿ƒçš„ä»·å€¼è§‚ï¼Œåšå‡ºå¿ äºè‡ªå·±çš„é€‰æ‹©ã€‚", 
             "ä»£è¡¨å…³ç³»å†²çªã€é”™è¯¯çš„å†³å®šæˆ–ä»·å€¼è§‚ä¸åˆã€‚å¯èƒ½åœ¨å…³ç³»ä¸­æ„Ÿåˆ°ä¸å’Œè°ï¼Œæˆ–åœ¨é€‰æ‹©é¢å‰çŠ¹è±«ä¸å†³ã€‚éœ€è¦é‡æ–°å®¡è§†è‡ªå·±çš„ä»·å€¼è§‚ï¼Œå¹¶ä¸ä¼´ä¾£è¿›è¡Œå¦è¯šçš„æ²Ÿé€šã€‚"),
            
            ("æˆ˜è½¦", ["æ„å¿—åŠ›", "èƒœåˆ©", "æ§åˆ¶", "å†³å¿ƒ", "è¡ŒåŠ¨"], 
             "ä»£è¡¨å‡­å€Ÿå¼ºå¤§çš„æ„å¿—åŠ›å’Œå†³å¿ƒå–å¾—èƒœåˆ©ã€‚è±¡å¾ç€é€šè¿‡è‡ªå¾‹å’Œä¸“æ³¨å…‹æœéšœç¢ï¼Œæœç€ç›®æ ‡å¥‹å‹‡å‰è¿›ã€‚åœ¨äº‹ä¸šä¸Šï¼Œæ˜¯é‡‡å–æœæ–­è¡ŒåŠ¨ã€äº‰å–æˆåŠŸçš„æ—¶åˆ»ã€‚åœ¨æŒ‘æˆ˜é¢å‰ï¼Œéœ€è¦ä¿æŒè‡ªä¿¡å’Œæ§åˆ¶åŠ›ã€‚", 
             "ä»£è¡¨å¤±æ§ã€ç¼ºä¹æ–¹å‘æˆ–è¡ŒåŠ¨åŠ›ä¸è¶³ã€‚å¯èƒ½å› ä¸ºç›®æ ‡ä¸æ˜ç¡®è€Œåˆ†æ•£äº†ç²¾åŠ›ï¼Œæˆ–åœ¨å‰è¿›çš„é“è·¯ä¸Šé‡åˆ°äº†æ— æ³•æ§åˆ¶çš„éšœç¢ã€‚éœ€è¦é‡æ–°èšç„¦ç›®æ ‡ï¼Œå¹¶æ•´åˆå†…åœ¨çš„å†²çªåŠ›é‡ã€‚"),
            
            ("åŠ›é‡", ["å†…åœ¨åŠ›é‡", "å‹‡æ°”", "è€å¿ƒ", "æ…ˆæ‚²", "æ•´åˆ"], 
             "ä»£è¡¨å†…åœ¨çš„å‹‡æ°”å’Œæ¸©å’Œçš„åŠ›é‡ã€‚ä¸æ˜¯é€šè¿‡å¤–åœ¨çš„å¼ºè¿«ï¼Œè€Œæ˜¯é€šè¿‡å†…å¿ƒçš„æ…ˆæ‚²å’Œè€å¿ƒæ¥é©¯æœé‡æ€§çš„æœ¬èƒ½ã€‚åœ¨å›°å¢ƒä¸­ï¼Œå±•ç°å‡ºåšéŸ§ä¸æ‹”çš„æ¯…åŠ›ã€‚åœ¨äººé™…å…³ç³»ä¸­ï¼Œä»¥æŸ”å…‹åˆšæ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚", 
             "ä»£è¡¨è½¯å¼±ã€ç¼ºä¹è‡ªä¿¡æˆ–è¢«å†…åœ¨çš„ææƒ§æ‰€æ§åˆ¶ã€‚å¯èƒ½å› ä¸ºæ€€ç–‘è‡ªå·±çš„èƒ½åŠ›è€Œä¸æ•¢è¡ŒåŠ¨ï¼Œæˆ–åœ¨å‹åŠ›ä¸‹è¡¨ç°å‡ºä¸å¿…è¦çš„æ”»å‡»æ€§ã€‚éœ€è¦é‡æ–°è¿æ¥å†…åœ¨çš„åŠ›é‡ï¼Œå¹¶ä»¥æ›´æ¸©å’Œçš„æ–¹å¼é¢å¯¹æŒ‘æˆ˜ã€‚"),
            
            ("éšè€…", ["å†…çœ", "ç‹¬å¤„", "å¯»æ±‚æ™ºæ…§", "æŒ‡å¯¼", "çµæ€§æ¢ç´¢"], 
             "ä»£è¡¨å‘å†…æ¢ç´¢ã€å¯»æ±‚æ™ºæ…§çš„æ—¶æœŸã€‚é¼“åŠ±æš‚æ—¶è¿œç¦»å°˜åš£ï¼Œé€šè¿‡ç‹¬å¤„å’Œå†…çœæ¥å¯»æ‰¾ç­”æ¡ˆã€‚åœ¨äººç”Ÿæ—…é€”ä¸­ï¼Œæ˜¯ä¸€ä½å†…åœ¨çš„å¯¼å¸ˆåœ¨æŒ‡å¼•æ–¹å‘ã€‚åœ¨å†³ç­–å‰ï¼Œéœ€è¦èŠ±æ—¶é—´è¿›è¡Œæ·±å…¥çš„æ€è€ƒã€‚", 
             "ä»£è¡¨å­¤ç«‹ã€ä¸ç¤¾ä¼šè„±èŠ‚æˆ–æ‹’ç»ä»–äººçš„å¸®åŠ©ã€‚å¯èƒ½å› ä¸ºè¿‡åº¦æ²‰æµ¸åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œè€Œæ„Ÿåˆ°å­¤ç‹¬ï¼Œæˆ–å› ä¸ºå›ºæ‰§è€Œæ‹’ç»æœ‰ç›Šçš„å»ºè®®ã€‚éœ€è¦æ‰¾åˆ°ç‹¬å¤„ä¸ç¤¾äº¤ä¹‹é—´çš„å¹³è¡¡ã€‚"),
            
            ("å‘½è¿ä¹‹è½®", ["å˜åŒ–", "å‘½è¿", "è½¬æŠ˜ç‚¹", "æœºä¼š", "å¾ªç¯"], 
             "ä»£è¡¨ç”Ÿå‘½ä¸­ä¸å¯é¿å…çš„å˜åŒ–å’Œè½¬æŠ˜ç‚¹ã€‚è±¡å¾ç€è¿æ°”çš„èµ·ä¼å’Œå®‡å®™çš„å¾ªç¯æ³•åˆ™ã€‚å½“æ—¶æ¥è¿è½¬æ—¶ï¼Œè¦æŠ“ä½æœºé‡ã€‚å½“æ—¶è¿ä¸æµæ—¶ï¼Œè¦ä¿æŒè€å¿ƒï¼Œç›¸ä¿¡ä¸€åˆ‡ç»ˆå°†è¿‡å»ã€‚è¿™æ˜¯ä¸€ä¸ªé¡ºåŠ¿è€Œä¸ºçš„æ—¶åˆ»ã€‚", 
             "ä»£è¡¨å„è¿ã€æŠ—æ‹’æ”¹å˜æˆ–å¤±æ§çš„å±€é¢ã€‚å¯èƒ½æ„Ÿè§‰åˆ°è¢«å‘½è¿æ‰å¼„ï¼Œæˆ–å› ä¸ºæŠ—æ‹’ç”Ÿå‘½ä¸­çš„è‡ªç„¶å˜åŒ–è€Œæ„Ÿåˆ°ç—›è‹¦ã€‚éœ€è¦å­¦ä¼šæ¥å—æ— æ³•æ§åˆ¶çš„äº‹æƒ…ï¼Œå¹¶ä»ä¸­å¯»æ‰¾æˆé•¿çš„æœºä¼šã€‚"),
            
            ("æ­£ä¹‰", ["å…¬æ­£", "å¹³è¡¡", "çœŸç†", "å› æœ", "è´£ä»»"], 
             "ä»£è¡¨å…¬æ­£ã€å¹³è¡¡å’Œå› æœæ³•åˆ™ã€‚å¼ºè°ƒéœ€è¦ä¸ºè‡ªå·±çš„è¡Œä¸ºæ‰¿æ‹…è´£ä»»ï¼Œå¹¶åšå‡ºç¬¦åˆçœŸç†å’Œé“å¾·çš„å†³å®šã€‚åœ¨æ³•å¾‹äº‹åŠ¡æˆ–åˆçº¦ä¸­ï¼Œé¢„ç¤ºç€ä¸€ä¸ªå…¬å¹³çš„ç»“æœã€‚åœ¨ä¸ªäººç”Ÿæ´»ä¸­ï¼Œæ˜¯å®¡è§†è‡ªå·±è¡Œä¸ºã€å¯»æ±‚å†…å¿ƒå¹³è¡¡çš„æ—¶åˆ»ã€‚", 
             "ä»£è¡¨ä¸å…¬æ­£ã€åè§æˆ–é€ƒé¿è´£ä»»ã€‚å¯èƒ½åœ¨æŸä»¶äº‹æƒ…ä¸Šå—åˆ°äº†ä¸å…¬å¹³çš„å¯¹å¾…ï¼Œæˆ–è‡ªå·±åšå‡ºäº†å¸¦æœ‰åè§çš„åˆ¤æ–­ã€‚éœ€è¦é¢å¯¹çœŸç›¸ï¼Œå¹¶ä¸ºè‡ªå·±çš„é”™è¯¯æ‰¿æ‹…åæœã€‚"),
            
            ("å€’åŠäºº", ["ç‰ºç‰²", "ç­‰å¾…", "æ–°è§†è§’", "é¡ºä»", "æ”¾ä¸‹"], 
             "ä»£è¡¨é€šè¿‡æš‚æ—¶çš„ç‰ºç‰²æˆ–ç­‰å¾…æ¥è·å¾—æ–°çš„è§†è§’ã€‚é¼“åŠ±æ”¾ä¸‹æ‰§å¿µï¼Œé¡ºä»äºå½“ä¸‹çš„å®‰æ’ã€‚è¿™æ˜¯ä¸€ä¸ªæš‚åœè¡ŒåŠ¨ã€å‘å†…çœ‹çš„æ—¶æœŸã€‚é€šè¿‡è½¬æ¢è§’åº¦ï¼Œä¹‹å‰æ— æ³•è§£å†³çš„é—®é¢˜å¯èƒ½ä¼šè±ç„¶å¼€æœ—ã€‚", 
             "ä»£è¡¨æ— æ„ä¹‰çš„ç‰ºç‰²ã€åœæ»ä¸å‰æˆ–æ‹–å»¶ã€‚å¯èƒ½å› ä¸ºå®³æ€•æ”¹å˜è€Œé™·å…¥åƒµå±€ï¼Œæˆ–åšå‡ºäº†ä¸å¿…è¦çš„ç‰ºç‰²å´æ²¡æœ‰æ¢æ¥ä»»ä½•å›æŠ¥ã€‚éœ€è¦è¯„ä¼°å½“å‰çš„å¤„å¢ƒï¼Œå¹¶é‡‡å–è¡ŒåŠ¨æ¥æ‰“ç ´åœæ»ã€‚"),
            
            ("æ­»ç¥", ["ç»“æŸ", "è½¬å˜", "é‡ç”Ÿ", "æ”¾ä¸‹è¿‡å»", "å˜é©"], 
             "ä»£è¡¨ä¸€ä¸ªå‘¨æœŸçš„ç»“æŸå’Œå¦ä¸€ä¸ªå‘¨æœŸçš„å¼€å§‹ã€‚è™½ç„¶å¯èƒ½ä¼´éšç€ç—›è‹¦å‘Šåˆ«ï¼Œä½†è¿™æ˜¯é€šå¾€é‡ç”Ÿå’Œæˆé•¿çš„å¿…ç»ä¹‹è·¯ã€‚éœ€è¦æ”¾ä¸‹ä¸å†æœåŠ¡äºä½ çš„äººã€äº‹ã€ç‰©ï¼Œä¸ºæ–°çš„å¯èƒ½æ€§è…¾å‡ºç©ºé—´ã€‚", 
             "ä»£è¡¨æŠ—æ‹’æ”¹å˜ã€åœæ»ä¸å‰æˆ–æ— æ³•ä»è¿‡å»ä¸­èµ°å‡ºæ¥ã€‚å› ä¸ºå®³æ€•ç»“æŸè€Œç´§æŠ“ä¸æ”¾ï¼Œåè€Œé˜»ç¢äº†æ–°çš„æˆé•¿ã€‚éœ€è¦é¼“èµ·å‹‡æ°”ï¼Œæ¥å—ç”Ÿå‘½ä¸­å¿…è¦çš„ç»ˆç»“ï¼Œå¹¶ç›¸ä¿¡æœªæ¥çš„å¯èƒ½æ€§ã€‚"),
            
            ("èŠ‚åˆ¶", ["å¹³è¡¡", "è€å¿ƒ", "è°ƒå’Œ", "æ•´åˆ", "ä¸­åº¸"], 
             "ä»£è¡¨å¹³è¡¡ã€å’Œè°ä¸è€å¿ƒã€‚é¼“åŠ±åœ¨ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢å¯»æ‰¾ä¸­åº¸ä¹‹é“ï¼Œå°†å¯¹ç«‹çš„åŠ›é‡è°ƒå’Œæˆä¸€ä¸ªå’Œè°çš„æ•´ä½“ã€‚åœ¨äººé™…å…³ç³»ä¸­ï¼Œæ˜¯æœ‰æ•ˆæ²Ÿé€šå’Œç›¸äº’ç†è§£çš„è±¡å¾ã€‚åœ¨ä¸ªäººå‘å±•ä¸­ï¼Œéœ€è¦è€å¿ƒå’Œç¨³å®šçš„æ­¥ä¼ã€‚", 
             "ä»£è¡¨å¤±è¡¡ã€æç«¯æˆ–ç¼ºä¹è€å¿ƒã€‚å¯èƒ½åœ¨ç”Ÿæ´»çš„æŸä¸ªæ–¹é¢è¿‡åº¦æ”¾çºµï¼Œæˆ–å› ä¸ºæ€¥äºæ±‚æˆè€Œå¯¼è‡´æ··ä¹±ã€‚éœ€è¦é‡æ–°æ‰¾åˆ°å†…å¿ƒçš„å¹³é™ï¼Œå¹¶ä»¥æ›´æ¸©å’Œã€æ›´æœ‰è€å¿ƒçš„æ–¹å¼æ¥å¤„ç†é—®é¢˜ã€‚"),
            
            ("æ¶é­”", ["æŸç¼š", "è¯±æƒ‘", "ç‰©è´¨ä¸»ä¹‰", "æˆç˜¾", "é˜´å½±é¢"], 
             "ä»£è¡¨è¢«ç‰©è´¨æ¬²æœ›ã€ä¸è‰¯ä¹ æƒ¯æˆ–è´Ÿé¢æ€æƒ³æ‰€æŸç¼šã€‚è±¡å¾ç€æˆ‘ä»¬å†…å¿ƒçš„é˜´å½±é¢å’Œæœªè¢«ç–—æ„ˆçš„åˆ›ä¼¤ã€‚éœ€è¦å‹‡æ•¢åœ°é¢å¯¹è‡ªå·±çš„æ¬²æœ›å’Œææƒ§ï¼Œæ‰èƒ½ä»ä¸­è§£æ”¾å‡ºæ¥ã€‚ä¹Ÿå¯èƒ½è¡¨ç¤ºä¸€æ®µå……æ»¡æ¿€æƒ…ä½†å¯èƒ½ä¸å¥åº·çš„å…³ç³»ã€‚", 
             "ä»£è¡¨æ‘†è„±æŸç¼šã€æ‰“ç ´æˆç˜¾æˆ–è·å¾—ç²¾ç¥ä¸Šçš„è§‰é†’ã€‚è±¡å¾ç€æ„è¯†åˆ°è‡ªå·±æ‰€å¤„çš„å›°å¢ƒï¼Œå¹¶å¼€å§‹é‡‡å–è¡ŒåŠ¨æ¥é‡è·è‡ªç”±ã€‚è¿™æ˜¯ä¸€ä¸ªé‡æ–°æŒæ§è‡ªå·±äººç”Ÿçš„æœ‰åŠ›æ—¶æœºã€‚"),
            
            ("å¡”", ["çªå˜", "ç¾éš¾", "å¯ç¤º", "è§£æ”¾", "é¢ è¦†"], 
             "ä»£è¡¨çªå¦‚å…¶æ¥çš„ã€é¢ è¦†æ€§çš„å˜åŒ–ã€‚é•¿æœŸä»¥æ¥å»ºç«‹çš„è™šå‡ä¿¡å¿µæˆ–ç»“æ„å¯èƒ½ä¼šç¬é—´å´©å¡Œï¼Œè™½ç„¶è¿‡ç¨‹ç—›è‹¦ï¼Œä½†è¿™ä¼šå¸¦æ¥çœŸç›¸çš„å¯ç¤ºå’Œæœ€ç»ˆçš„è§£æ”¾ã€‚è¿™æ˜¯ä¸€ä¸ªè¢«è¿«é¢å¯¹ç°å®ã€é‡å»ºåŸºç¡€çš„æ—¶åˆ»ã€‚", 
             "ä»£è¡¨é¿å…å¿…è¦çš„æ”¹å˜ã€å®³æ€•ç¾éš¾æˆ–æ‹–å»¶å±æœºã€‚å› ä¸ºå®³æ€•é¢å¯¹çœŸç›¸è€Œç»´æŒç€ä¸€ä¸ªä¸ç¨³å®šçš„ç»“æ„ï¼Œä½†è¿™åªä¼šè®©æœ€ç»ˆçš„å´©æºƒæ›´å…·ç ´åæ€§ã€‚éœ€è¦ä¸»åŠ¨è¿æ¥æ”¹å˜ï¼Œè€Œä¸æ˜¯è¢«åŠ¨åœ°ç­‰å¾…ç¾éš¾é™ä¸´ã€‚"),
            
            ("æ˜Ÿæ˜Ÿ", ["å¸Œæœ›", "çµæ„Ÿ", "æ²»æ„ˆ", "å¹³é™", "ç²¾ç¥æŒ‡å¼•"], 
             "ä»£è¡¨åœ¨é»‘æš—ä¸­é‡ç‡ƒå¸Œæœ›ï¼Œè·å¾—çµæ„Ÿå’Œæ²»æ„ˆã€‚åœ¨ç»å†äº†æ··ä¹±ä¹‹åï¼Œå†…å¿ƒé‡å½’å¹³é™ã€‚è¿™æ˜¯ä¸€ä¸ªå……æ»¡ä¿¡å¿µå’Œä¹è§‚ç²¾ç¥çš„æ—¶æœŸï¼Œå®‡å®™æ­£åœ¨ä¸ºä½ æä¾›ç²¾ç¥ä¸Šçš„æŒ‡å¼•ã€‚å¯¹æœªæ¥å……æ»¡ä¿¡å¿ƒã€‚", 
             "ä»£è¡¨ç»æœ›ã€å¤±å»ä¿¡å¿µæˆ–ä¸çµæ„Ÿè„±èŠ‚ã€‚å¯èƒ½å› ä¸ºä¹‹å‰çš„å›°å¢ƒè€Œæ„Ÿåˆ°å¿ƒç°æ„å†·ï¼Œçœ‹ä¸åˆ°æœªæ¥çš„æ–¹å‘ã€‚éœ€è¦é‡æ–°æ‰¾å›å†…å¿ƒçš„å¸Œæœ›ä¹‹å…‰ï¼Œå¹¶ç›¸ä¿¡è‡ªå·±æœ‰èƒ½åŠ›å…‹æœå›°éš¾ã€‚"),
            
            ("æœˆäº®", ["å¹»è§‰", "ææƒ§", "æ½œæ„è¯†", "ç›´è§‰", "è¿·æƒ‘"], 
             "ä»£è¡¨æ·±å…¥æ½œæ„è¯†çš„é¢†åŸŸï¼Œé¢å¯¹å†…å¿ƒçš„ææƒ§å’Œå¹»è§‰ã€‚æƒ…å†µå¯èƒ½å¹¶ä¸åƒè¡¨é¢çœ‹èµ·æ¥é‚£æ ·æ¸…æ™°ï¼Œéœ€è¦ä¾èµ–ç›´è§‰æ¥å¯¼èˆªã€‚è¿™æ˜¯ä¸€ä¸ªå……æ»¡ä¸ç¡®å®šæ€§å’Œè¿·æƒ‘çš„æ—¶æœŸï¼Œä½†ä¹Ÿæ˜¯æ¢ç´¢å†…å¿ƒæ·±å¤„ç§˜å¯†çš„æœºä¼šã€‚", 
             "ä»£è¡¨å…‹æœææƒ§ã€çœ‹æ¸…çœŸç›¸æˆ–èµ°å‡ºè¿·æƒ‘ã€‚å½“ç†æ™ºçš„å…‰èŠ’ç…§è¿›æ½œæ„è¯†çš„é»‘æš—ï¼Œä¹‹å‰æ¨¡ç³Šä¸æ¸…çš„äº‹æƒ…ä¼šå˜å¾—æ˜æœ—ã€‚è¿™æ˜¯ä¸€ä¸ªä»ç„¦è™‘å’Œä¸å®‰ä¸­è§£è„±å‡ºæ¥ï¼Œé‡è·å†…å¿ƒæ¸…æ™°çš„æ—¶åˆ»ã€‚"),
            
            ("å¤ªé˜³", ["æˆåŠŸ", "å–œæ‚¦", "æ´»åŠ›", "æ¸…æ™°", "ä¹è§‚"], 
             "ä»£è¡¨æˆåŠŸã€å–œæ‚¦å’Œç”Ÿå‘½çš„æ´»åŠ›ã€‚æ‰€æœ‰çš„ç–‘è™‘å’Œå›°æƒ‘éƒ½å·²æ¶ˆæ•£ï¼Œå‰æ–¹çš„é“è·¯æ¸…æ™°è€Œå…‰æ˜ã€‚è¿™æ˜¯ä¸€ä¸ªå……æ»¡è‡ªä¿¡å’Œä¹è§‚ç²¾ç¥çš„æ—¶æœŸï¼Œå°½æƒ…äº«å—åŠªåŠ›å¸¦æ¥çš„æˆæœå’Œä½¿ç”¨ä¸­çš„ä¹è¶£å§ã€‚", 
             "ä»£è¡¨æš‚æ—¶çš„æŒ«æŠ˜ã€ç¼ºä¹çƒ­æƒ…æˆ–è¿‡åº¦è‡ªä¿¡ã€‚è™½ç„¶ç›®æ ‡æœ€ç»ˆå¯ä»¥è¾¾æˆï¼Œä½†å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å»¶è¿Ÿã€‚ä¹Ÿå¯èƒ½å› ä¸ºè¿‡äºä¹è§‚è€Œå¿½è§†äº†ç»†èŠ‚ã€‚éœ€è¦ä¿æŒè°¦é€Šï¼Œå¹¶é‡æ–°ç‚¹ç‡ƒå¯¹ç”Ÿæ´»çš„çƒ­æƒ…ã€‚"),
            
            ("å®¡åˆ¤", ["é‡ç”Ÿ", "è§‰é†’", "æ¸…ç®—", "å®½æ•", "å¬å”¤"], 
             "ä»£è¡¨ä¸€ä¸ªé‡è¦çš„è§‰é†’æ—¶åˆ»ï¼Œå¯¹è¿‡å»è¿›è¡Œæ¸…ç®—å’Œåæ€ï¼Œå¹¶åšå‡ºæœ€ç»ˆçš„è¯„åˆ¤ã€‚è¿™æ˜¯ä¸€ä¸ªè·å¾—å®½æ•ã€è¿æ¥é‡ç”Ÿçš„æœºä¼šã€‚ä½ æ­£åœ¨è¢«å¬å”¤å»å®ç°ä¸€ä¸ªæ›´é«˜çš„ç›®æ ‡ï¼Œå¼€å¯äººç”Ÿçš„æ–°ç¯‡ç« ã€‚", 
             "ä»£è¡¨è‡ªæˆ‘æ€€ç–‘ã€é€ƒé¿è¯„åˆ¤æˆ–æ‹’ç»æˆé•¿çš„æœºä¼šã€‚å¯èƒ½å› ä¸ºå®³æ€•é¢å¯¹è¿‡å»çš„é”™è¯¯è€Œé™·å…¥å†…ç–šå’Œæ‚”æ¨ä¹‹ä¸­ã€‚éœ€è¦å­¦ä¼šå®½æ•è‡ªå·±å’Œä»–äººï¼Œå¹¶å‹‡æ•¢åœ°å›åº”å†…åœ¨çš„æˆé•¿å¬å”¤ã€‚"),
            
            ("ä¸–ç•Œ", ["å®Œæˆ", "æ•´åˆ", "æˆå°±", "åœ†æ»¡", "æ—…è¡Œ"], 
             "ä»£è¡¨ä¸€ä¸ªå‘¨æœŸçš„åœ†æ»¡å®Œæˆå’Œç›®æ ‡çš„è¾¾æˆã€‚æ‰€æœ‰çš„åŠªåŠ›éƒ½å¾—åˆ°äº†å›æŠ¥ï¼Œä½ å·²ç»å°†ç”Ÿå‘½çš„å„ä¸ªæ–¹é¢æˆåŠŸåœ°æ•´åˆåœ¨ä¸€èµ·ã€‚è¿™æ˜¯ä¸€ä¸ªåº†ç¥æˆå°±ã€äº«å—å’Œè°ä¸æ»¡è¶³çš„æ—¶åˆ»ã€‚ä¹Ÿå¯èƒ½é¢„ç¤ºç€é•¿é€”æ—…è¡Œæˆ–èµ°å‘ä¸–ç•Œã€‚ ", 
             "ä»£è¡¨æœªå®Œæˆçš„äº‹ä¸šã€ç¼ºä¹é—­ç¯æˆ–åœæ»ä¸å‰ã€‚è™½ç„¶ç¦»æˆåŠŸä»…ä¸€æ­¥ä¹‹é¥ï¼Œä½†å› ä¸ºæŸäº›åŸå› è€Œæ— æ³•è¾¾åˆ°æœ€ç»ˆçš„åœ†æ»¡ã€‚éœ€è¦å®¡è§†æ˜¯å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ï¼Œå¹¶åŠªåŠ›å®Œæˆè¿™æœ€åçš„æ—…ç¨‹ã€‚")
        ]
        
        for i, (name, keywords, upright, reversed) in enumerate(major_arcana):
            cards.append(TarotCard(
                name=name,
                suit=Suit.MAJOR_ARCANA,
                number=i,
                keywords=keywords,
                upright_meaning=upright,
                reversed_meaning=reversed,
                description=f"å¤§é˜¿å¡çº³ç¬¬{i}å¼ ç‰Œï¼Œä»£è¡¨{keywords[0]}çš„èƒ½é‡"
            ))
        
        # å°é˜¿å¡çº³ (56å¼ )
        minor_arcana_meanings = {
            Suit.WANDS: {
                "suit_name": "æƒæ–", "suit_desc": "ç«å…ƒç´ ï¼Œä»£è¡¨æ¿€æƒ…ã€åˆ›é€ åŠ›ã€è¡ŒåŠ¨å’Œæ„å¿—åŠ›",
                "cards": {
                    1: (["æ–°èµ·ç‚¹", "çµæ„Ÿ", "è¡ŒåŠ¨åŠ›"], "æ–°çš„æ¿€æƒ…æˆ–é¡¹ç›®å¼€å§‹ï¼Œå……æ»¡åˆ›é€ åŠ›çš„ç«èŠ±ã€‚", "è®¡åˆ’å»¶è¿Ÿï¼Œç¼ºä¹åŠ¨åŠ›ï¼Œæ–¹å‘ä¸æ˜ç¡®ã€‚"),
                    2: (["è®¡åˆ’", "å†³ç­–", "ä¸ªäººåŠ›é‡"], "ç«™åœ¨åå­—è·¯å£ï¼Œéœ€è¦è§„åˆ’æœªæ¥ï¼Œè¯„ä¼°é€‰æ‹©ã€‚", "å®³æ€•æœªçŸ¥ï¼Œç¼ºä¹é•¿è¿œè®¡åˆ’ï¼Œä¼˜æŸ”å¯¡æ–­ã€‚"),
                    3: (["æ‰©å±•", "è¿œè§", "é¢†å¯¼åŠ›"], "åˆæ­¥æˆåŠŸï¼Œæ˜¯æ—¶å€™å°†çœ¼å…‰æ”¾å¾—æ›´è¿œï¼Œå¯»æ±‚åˆä½œã€‚", "è®¡åˆ’å—é˜»ï¼Œç¼ºä¹è¿œè§ï¼Œåˆä½œå‡ºç°é—®é¢˜ã€‚"),
                    4: (["åº†ç¥", "å’Œè°", "ç¨³å®š"], "åº†ç¥é˜¶æ®µæ€§çš„æˆåŠŸï¼Œäº«å—å®¶åº­çš„å’Œè°ä¸ç¨³å®šã€‚", "å…³ç³»ä¸ç¨³å®šï¼Œå®¶åº­å†…éƒ¨æœ‰çŸ›ç›¾ï¼Œåº†ç¥è¢«æ¨è¿Ÿã€‚"),
                    5: (["ç«äº‰", "å†²çª", "åˆ†æ­§"], "è‰¯æ€§çš„ç«äº‰æˆ–å†²çªï¼Œä¸åŒæ„è§çš„ç¢°æ’ã€‚", "æ¿€çƒˆçš„å†²çªï¼Œæ··ä¹±ï¼Œä¸ºé¿å…å†²çªè€Œå‹æŠ‘è‡ªå·±ã€‚"),
                    6: (["èƒœåˆ©", "è®¤å¯", "æˆåŠŸ"], "å–å¾—å…¬å¼€çš„èƒœåˆ©å’Œè®¤å¯ï¼Œäº«å—æˆåŠŸçš„å–œæ‚¦ã€‚", "æˆåŠŸå»¶è¿Ÿï¼Œç¼ºä¹è®¤å¯ï¼Œéª„å‚²è‡ªå¤§å¯¼è‡´å¤±è´¥ã€‚"),
                    7: (["æŒ‘æˆ˜", "å‹‡æ°”", "åšå®ˆç«‹åœº"], "é¢å¯¹æŒ‘æˆ˜ï¼Œéœ€è¦é¼“èµ·å‹‡æ°”ï¼Œæå«è‡ªå·±çš„ç«‹åœºã€‚", "ä¸å ªé‡è´Ÿï¼Œå¯¡ä¸æ•Œä¼—ï¼Œæ”¾å¼ƒè‡ªå·±çš„ç«‹åœºã€‚"),
                    8: (["å¿«é€Ÿè¡ŒåŠ¨", "æ¶ˆæ¯", "æ—…è¡Œ"], "äº‹æƒ…è¿›å±•è¿…é€Ÿï¼Œå¯èƒ½æ”¶åˆ°é‡è¦æ¶ˆæ¯æˆ–æœ‰æ—…è¡Œæœºä¼šã€‚", "è¡ŒåŠ¨å—é˜»ï¼Œå»¶è¿Ÿï¼Œé”™è¿‡é‡è¦æ¶ˆæ¯ã€‚"),
                    9: (["åšéŸ§", "é˜²å¾¡", "æ¯…åŠ›"], "ç»å†äº†æˆ˜æ–—åçš„ç–²æƒ«ï¼Œä½†ä»éœ€ä¿æŒè­¦æƒ•å’Œæ¯…åŠ›ã€‚", "å›ºæ‰§å·±è§ï¼Œåæ‰§ï¼Œæ— æ³•æ”¾ä¸‹è¿‡å»çš„ä¼¤ç—›ã€‚"),
                    10: (["è´Ÿæ‹…", "è´£ä»»", "å‹åŠ›"], "æ‰¿æ‹…äº†è¿‡å¤šçš„è´£ä»»å’Œè´Ÿæ‹…ï¼Œæ„Ÿåˆ°å‹åŠ›å·¨å¤§ã€‚", "ä¸å ªé‡è´Ÿï¼Œæ”¾å¼ƒè´£ä»»ï¼Œè¢«å‹åŠ›å‹å®ã€‚"),
                    "ä¾ä»": (["çƒ­æƒ…", "æ¢ç´¢", "ä¿¡ä½¿"], "å……æ»¡å¥½å¥‡å¿ƒå’Œçƒ­æƒ…ï¼Œæ¸´æœ›æ¢ç´¢æ–°é¢†åŸŸï¼Œå¸¦æ¥æ–°æ¶ˆæ¯ã€‚", "ç¼ºä¹æ–¹å‘ï¼Œçƒ­æƒ…æ— æ³•æŒç»­ï¼Œå¸¦æ¥åæ¶ˆæ¯ã€‚"),
                    "éª‘å£«": (["è¡ŒåŠ¨åŠ›", "çƒ­æƒ…", "å†²åŠ¨"], "å……æ»¡æ´»åŠ›ï¼Œè¿…é€Ÿé‡‡å–è¡ŒåŠ¨ï¼Œä½†å¯èƒ½æœ‰äº›å†²åŠ¨ã€‚", "é²è½è¡Œäº‹ï¼Œå†²åŠ¨å¯¼è‡´é”™è¯¯ï¼Œç²¾åŠ›è€—å°½ã€‚"),
                    "ç‹å": (["è‡ªä¿¡", "é­…åŠ›", "åˆ›é€ åŠ›"], "å……æ»¡è‡ªä¿¡å’Œé­…åŠ›çš„é¢†å¯¼è€…ï¼Œèƒ½æ¿€åŠ±ä»–äººã€‚", "å«‰å¦’ï¼ŒæŠ¥å¤å¿ƒå¼ºï¼Œåˆ›é€ åŠ›è¢«å‹æŠ‘ã€‚"),
                    "å›½ç‹": (["é¢†å¯¼åŠ›", "è¿œè§", "æƒå¨"], "æœ‰è¿œè§çš„ã€æˆç†Ÿçš„é¢†å¯¼è€…ï¼ŒæŒæ§å…¨å±€ã€‚", "ä¸“åˆ¶ï¼Œæ»¥ç”¨æƒåŠ›ï¼Œç¼ºä¹è¿œè§ã€‚")
                }
            },
            Suit.CUPS: {
                "suit_name": "åœ£æ¯", "suit_desc": "æ°´å…ƒç´ ï¼Œä»£è¡¨æƒ…æ„Ÿã€å…³ç³»ã€ç›´è§‰å’Œåˆ›é€ åŠ›",
                "cards": {
                    1: (["æ–°æ‹æƒ…", "æƒ…æ„ŸæµåŠ¨", "åˆ›é€ åŠ›"], "æ–°çš„æƒ…æ„Ÿå¼€å§‹ï¼Œçˆ±ä¸åˆ›é€ åŠ›çš„æ¶Œç°ã€‚", "æƒ…æ„Ÿå‹æŠ‘ï¼Œå…³ç³»ç©ºè™šï¼Œåˆ›é€ åŠ›å—é˜»ã€‚"),
                    2: (["ç»“åˆ", "ä¼™ä¼´å…³ç³»", "å¸å¼•åŠ›"], "å’Œè°çš„ä¼™ä¼´å…³ç³»ï¼Œçµé­‚çš„è¿æ¥ï¼Œç›¸äº’å¸å¼•ã€‚", "å…³ç³»å¤±è¡¡ï¼Œåˆ†æ‰‹ï¼Œæ²Ÿé€šä¸ç•…ã€‚"),
                    3: (["åº†ç¥", "å‹è°Š", "å›¢ä½“"], "ä¸æœ‹å‹ä»¬ä¸€èµ·åº†ç¥ï¼Œäº«å—ç¤¾äº¤çš„ä¹è¶£ã€‚", "è¿‡åº¦æ”¾çºµï¼Œå‹è°Šç ´è£‚ï¼Œå­¤ç‹¬ã€‚"),
                    4: (["å†·æ¼ ", "æ²‰æ€", "é”™å¤±æœºä¼š"], "å¯¹ç°çŠ¶æ„Ÿåˆ°ä¸æ»¡å’Œå†·æ¼ ï¼Œé”™è¿‡äº†æ–°çš„æœºä¼šã€‚", "èµ°å‡ºå†·æ¼ ï¼Œæ¥å—æ–°çš„æœºä¼šï¼Œé‡æ–°ç‡ƒèµ·çƒ­æƒ…ã€‚"),
                    5: (["å¤±è½", "æ‚²ä¼¤", "å¤±æœ›"], "ä¸ºå¤±å»è€Œæ‚²ä¼¤ï¼Œä½†ä»æœ‰å¸Œæœ›å­˜åœ¨ã€‚", "æ— æ³•èµ°å‡ºæ‚²ä¼¤ï¼Œæ²‰æººäºè¿‡å»ï¼Œçœ‹ä¸åˆ°å¸Œæœ›ã€‚"),
                    6: (["æ€€æ—§", "ç«¥å¹´", "çº¯çœŸ"], "ç¾å¥½çš„å›å¿†ï¼Œä¸è¿‡å»çš„äººé‡é€¢ï¼Œé‡æ‹¾çº¯çœŸã€‚", "æ²‰æººäºè¿‡å»ï¼Œæ— æ³•æˆé•¿ï¼Œç«¥å¹´åˆ›ä¼¤ã€‚"),
                    7: (["å¹»æƒ³", "é€‰æ‹©", "ç™½æ—¥æ¢¦"], "é¢ä¸´å¤šç§é€‰æ‹©ï¼Œä½†å¾ˆå¤šæ˜¯ä¸åˆ‡å®é™…çš„å¹»æƒ³ã€‚", "ä»å¹»æƒ³ä¸­æ¸…é†’ï¼Œåšå‡ºæ˜ç¡®çš„é€‰æ‹©ï¼Œä»˜è¯¸è¡ŒåŠ¨ã€‚"),
                    8: (["ç¦»å¼€", "è¿½å¯»", "æ”¾å¼ƒ"], "ä¸ºäº†è¿½å¯»æ›´æ·±å±‚çš„æ„ä¹‰è€Œç¦»å¼€ç†Ÿæ‚‰çš„ç¯å¢ƒã€‚", "å®³æ€•æ”¹å˜ï¼Œåœæ»ä¸å‰ï¼Œä¸çŸ¥é“è‡ªå·±æƒ³è¦ä»€ä¹ˆã€‚"),
                    9: (["æ»¡è¶³", "æ„¿æœ›æˆçœŸ", "èˆ’é€‚"], "æƒ…æ„Ÿå’Œç‰©è´¨ä¸Šçš„æ»¡è¶³ï¼Œæ„¿æœ›å¾—ä»¥å®ç°ã€‚", "è‡ªæ»¡ï¼Œè´ªå©ªï¼Œç‰©è´¨ä¸»ä¹‰ã€‚"),
                    10: (["å’Œè°", "å¹¸ç¦å®¶åº­", "æƒ…æ„Ÿåœ†æ»¡"], "å®¶åº­å¹¸ç¦ï¼Œæƒ…æ„Ÿä¸Šçš„ç»ˆææ»¡è¶³ä¸å’Œè°ã€‚", "å®¶åº­ä¸å’Œï¼Œå…³ç³»ç ´è£‚ï¼Œæ— æ³•å®ç°æƒ…æ„Ÿæ»¡è¶³ã€‚"),
                    "ä¾ä»": (["ç›´è§‰", "ä¿¡æ¯", "åˆ›é€ åŠ›"], "å€¾å¬ç›´è§‰ï¼Œæ”¶åˆ°æƒ…æ„Ÿæ–¹é¢çš„ä¿¡æ¯ï¼Œå¯Œæœ‰åˆ›é€ åŠ›ã€‚", "æƒ…æ„Ÿä¸æˆç†Ÿï¼Œé€ƒé¿ç°å®ï¼Œåˆ›é€ åŠ›è¢«å‹æŠ‘ã€‚"),
                    "éª‘å£«": (["æµªæ¼«", "é­…åŠ›", "ç†æƒ³ä¸»ä¹‰"], "æµªæ¼«çš„è¿½æ±‚è€…ï¼Œå¯Œæœ‰é­…åŠ›ï¼Œä½†å¯èƒ½è¿‡äºç†æƒ³åŒ–ã€‚", "æƒ…æ„Ÿæ“æ§ï¼Œå–„å˜ï¼Œä¸åˆ‡å®é™…çš„å¹»æƒ³ã€‚"),
                    "ç‹å": (["åŒæƒ…å¿ƒ", "ç›´è§‰", "æ»‹å…»"], "å¯Œæœ‰åŒæƒ…å¿ƒå’Œç›´è§‰åŠ›ï¼Œèƒ½æä¾›æƒ…æ„Ÿæ”¯æŒã€‚", "æƒ…ç»ªåŒ–ï¼Œè¿‡åº¦æ•æ„Ÿï¼Œæƒ…æ„Ÿå‹’ç´¢ã€‚"),
                    "å›½ç‹": (["æƒ…æ„Ÿæˆç†Ÿ", "æ§åˆ¶", "æ™ºæ…§"], "æƒ…æ„Ÿæˆç†Ÿä¸”è‡ªæ§çš„é¢†å¯¼è€…ï¼Œå……æ»¡æ™ºæ…§å’ŒåŒæƒ…å¿ƒã€‚", "æƒ…æ„Ÿæ“æ§ï¼Œå–œæ€’æ— å¸¸ï¼Œå‹æŠ‘æƒ…æ„Ÿã€‚")
                }
            },
            Suit.SWORDS: {
                "suit_name": "å®å‰‘", "suit_desc": "é£å…ƒç´ ï¼Œä»£è¡¨æ€æƒ³ã€æ²Ÿé€šã€å†²çªå’ŒæŒ‘æˆ˜",
                "cards": {
                    1: (["æ¸…æ™°", "çªç ´", "çœŸç†"], "æ€æƒ³ä¸Šçš„çªç ´ï¼Œè·å¾—æ¸…æ™°çš„è®¤çŸ¥ï¼Œçœ‹åˆ°çœŸç›¸ã€‚", "æ··ä¹±ï¼Œå›°æƒ‘ï¼Œé”™è¯¯çš„å†³å®šã€‚"),
                    2: (["åƒµå±€", "é€‰æ‹©", "é€ƒé¿"], "å¤„äºä¸¤éš¾å¢ƒåœ°ï¼Œéœ€è¦åšå‡ºå†³å®šä½†é€‰æ‹©é€ƒé¿ã€‚", "åšå‡ºè‰°éš¾çš„å†³å®šï¼Œçœ‹æ¸…çœŸç›¸ï¼Œæ‰“ç ´åƒµå±€ã€‚"),
                    3: (["å¿ƒç¢", "æ‚²ä¼¤", "åˆ†ç¦»"], "ç»å†ç—›è‹¦çš„åˆ†ç¦»æˆ–èƒŒå›ï¼Œæ„Ÿåˆ°å¿ƒç¢ã€‚", "ä»æ‚²ä¼¤ä¸­æ¢å¤ï¼ŒåŸè°…ï¼Œæ¥å—ç°å®ã€‚"),
                    4: (["ä¼‘æ¯", "æ¢å¤", "æ²‰æ€"], "éœ€è¦ä»å†²çªå’Œå‹åŠ›ä¸­æš‚æ—¶é€€å‡ºï¼Œè¿›è¡Œä¼‘æ¯å’Œæ¢å¤ã€‚", "ç²¾ç–²åŠ›ç«­ï¼Œåœæ»ä¸å‰ï¼Œæ‹’ç»ä¼‘æ¯ã€‚"),
                    5: (["å†²çª", "å¤±è´¥", "ä¸å…‰å½©çš„èƒœåˆ©"], "å†²çªåçš„å¤±è´¥æ„Ÿï¼Œæˆ–ä»¥ä¸å…‰å½©çš„æ–¹å¼å–èƒœã€‚", "å’Œè§£ï¼Œæ”¾ä¸‹äº‰æ–—ï¼Œå¯»æ±‚åŒèµ¢ã€‚"),
                    6: (["è¿‡æ¸¡", "æ—…è¡Œ", "è§£è„±"], "ä»å›°å¢ƒä¸­èµ°å‡ºï¼Œè¿›å…¥ä¸€ä¸ªæ›´å¹³é™çš„æ—¶æœŸï¼Œå¯èƒ½æ˜¯å­—é¢ä¸Šçš„æ—…è¡Œã€‚", "æ— æ³•æ‘†è„±è¿‡å»ï¼Œè¿‡æ¸¡æœŸé‡åˆ°å›°éš¾ï¼Œè®¡åˆ’å—é˜»ã€‚"),
                    7: (["æ¬ºéª—", "ç­–ç•¥", "é€ƒé¿"], "ä½¿ç”¨ç­–ç•¥æˆ–æ¬ºéª—æ¥è¾¾åˆ°ç›®çš„ï¼Œå¯èƒ½åœ¨é€ƒé¿è´£ä»»ã€‚", "é¢å¯¹ç°å®ï¼Œè¯šå®ï¼Œæ”¾å¼ƒæ— æ•ˆçš„ç­–ç•¥ã€‚"),
                    8: (["æŸç¼š", "é™åˆ¶", "æ— åŠ©æ„Ÿ"], "æ„Ÿè§‰è¢«å›°ä½ï¼Œå—åˆ°é™åˆ¶ï¼Œä½†è¿™ç§æŸç¼šå¤šæ˜¯è‡ªæˆ‘é€ æˆçš„ã€‚", "æ‰“ç ´æŸç¼šï¼Œé‡è·è‡ªç”±ï¼Œæ„è¯†åˆ°è‡ªå·±çš„åŠ›é‡ã€‚"),
                    9: (["ç„¦è™‘", "ææƒ§", "å™©æ¢¦"], "è¢«ç„¦è™‘ã€ææƒ§å’Œæ‹…å¿§æ‰€å›°æ‰°ï¼Œå¤œä¸èƒ½å¯ã€‚", "é¢å¯¹ææƒ§ï¼Œå¯»æ±‚å¸®åŠ©ï¼Œä»ç„¦è™‘ä¸­è§£è„±ã€‚"),
                    10: (["ç»ˆç»“", "å¤±è´¥", "èƒŒå›"], "ç—›è‹¦çš„ç»ˆç»“ï¼Œå½»åº•çš„å¤±è´¥ï¼Œè¢«èƒŒå›çš„æ„Ÿè§‰ã€‚", "æ¥å—å¤±è´¥ï¼Œä»è°·åº•åå¼¹ï¼Œè¿æ¥æ–°çš„å¼€å§‹ã€‚"),
                    "ä¾ä»": (["å¥½å¥‡", "æ²Ÿé€š", "æ–°æ€æƒ³"], "å……æ»¡å¥½å¥‡ï¼Œæ¸´æœ›å­¦ä¹ å’Œæ²Ÿé€šï¼Œå¸¦æ¥æ–°æ€æƒ³ã€‚", "æ•£æ’­è°£è¨€ï¼Œè¯´è¯ä¸ç»æ€è€ƒï¼Œç¼ºä¹æ·±åº¦ã€‚"),
                    "éª‘å£«": (["æœæ–­", "é‡å¿ƒ", "è¡ŒåŠ¨è¿…é€Ÿ"], "ç›®æ ‡æ˜ç¡®ï¼Œè¡ŒåŠ¨è¿…é€Ÿï¼Œå……æ»¡é‡å¿ƒï¼Œä½†å¯èƒ½ç¼ºä¹åŒæƒ…å¿ƒã€‚", "é²è½ï¼Œæ”»å‡»æ€§å¼ºï¼Œä¸æ‹©æ‰‹æ®µã€‚"),
                    "ç‹å": (["æ™ºæ…§", "ç‹¬ç«‹", "æ¸…æ™°"], "è¯šå®ã€ç‹¬ç«‹ã€æ™ºæ…§çš„å¥³æ€§ï¼Œæ€è·¯æ¸…æ™°ï¼Œä¸æ„Ÿæƒ…ç”¨äº‹ã€‚", "åˆ»è–„ï¼Œå­¤ç«‹ï¼Œæ»¥ç”¨æ™ºæ…§ã€‚"),
                    "å›½ç‹": (["æƒå¨", "æ™ºæ…§", "å…¬æ­£"], "æ™ºæ…§ã€å…¬æ­£ã€æœ‰æƒå¨çš„é¢†å¯¼è€…ï¼Œå–„äºæ²Ÿé€šå’Œå†³ç­–ã€‚", "ä¸“åˆ¶ï¼Œå†·é…·æ— æƒ…ï¼Œæ»¥ç”¨æƒåŠ›ã€‚")
                }
            },
            Suit.PENTACLES: {
                "suit_name": "æ˜Ÿå¸", "suit_desc": "åœŸå…ƒç´ ï¼Œä»£è¡¨ç‰©è´¨ã€é‡‘é’±ã€å·¥ä½œå’Œç°å®",
                "cards": {
                    1: (["æœºä¼š", "æ˜¾åŒ–", "ç¹è£"], "æ–°çš„ç‰©è´¨æœºä¼šï¼Œæ˜¯å®ç°è´¢åŠ¡ç›®æ ‡çš„å¥½æ—¶æœºã€‚", "é”™å¤±æœºä¼šï¼Œè´¢åŠ¡è®¡åˆ’ä¸å‘¨ï¼ŒæŠ•èµ„å¤±è´¥ã€‚"),
                    2: (["å¹³è¡¡", "é€‚åº”æ€§", "å˜åŒ–"], "åœ¨å˜åŒ–ä¸­ä¿æŒå¹³è¡¡ï¼Œçµæ´»åœ°å¤„ç†å¤šé¡¹ä»»åŠ¡ã€‚", "è´¢åŠ¡ä¸ç¨³å®šï¼Œæ— æ³•å…¼é¡¾ï¼Œç”Ÿæ´»å¤±è¡¡ã€‚"),
                    3: (["å›¢é˜Ÿåˆä½œ", "æŠ€èƒ½", "å“è´¨"], "é€šè¿‡å›¢é˜Ÿåˆä½œå’Œç²¾æ¹›çš„æŠ€èƒ½è·å¾—æˆåŠŸã€‚", "åˆä½œä¸ç•…ï¼Œå·¥ä½œè´¨é‡å·®ï¼Œç¼ºä¹å›¢é˜Ÿç²¾ç¥ã€‚"),
                    4: (["å æœ‰", "ç¨³å®š", "ä¿å®ˆ"], "è¿½æ±‚ç‰©è´¨ä¸Šçš„ç¨³å®šå’Œå®‰å…¨ï¼Œä½†å¯èƒ½è¿‡äºä¿å®ˆå’Œåå•¬ã€‚", "è´¢åŠ¡æŸå¤±ï¼Œæ…·æ…¨ï¼Œæ”¾ä¸‹å¯¹ç‰©è´¨çš„æ‰§ç€ã€‚"),
                    5: (["è´«å›°", "é€†å¢ƒ", "å­¤ç«‹"], "ç»å†ç‰©è´¨ä¸Šçš„å›°éš¾ï¼Œæ„Ÿåˆ°è¢«å­¤ç«‹å’Œé—å¼ƒã€‚", "èµ°å‡ºå›°å¢ƒï¼Œæ¥å—å¸®åŠ©ï¼Œæ‰¾åˆ°å¸Œæœ›ã€‚"),
                    6: (["æ…·æ…¨", "æ…ˆå–„", "åˆ†äº«"], "æ…·æ…¨åœ°ç»™äºˆæˆ–æ¥å—å¸®åŠ©ï¼Œå®ç°è´¢åŠ¡ä¸Šçš„å¹³è¡¡ã€‚", "å€ºåŠ¡ï¼Œåå•¬ï¼Œä¸å¹³ç­‰çš„ç»™äºˆå’Œæ¥å—ã€‚"),
                    7: (["è€å¿ƒ", "è¯„ä¼°", "å›æŠ¥"], "è€å¿ƒç­‰å¾…æŠ•èµ„çš„å›æŠ¥ï¼Œè¯„ä¼°ç›®å‰çš„è¿›å±•ã€‚", "ä¸è€çƒ¦ï¼Œæ€¥äºæ±‚æˆï¼Œå¯¹ç»“æœæ„Ÿåˆ°å¤±æœ›ã€‚"),
                    8: (["æŠ€èƒ½", "ä¸“æ³¨", "ç²¾é€š"], "é€šè¿‡åŠªåŠ›å·¥ä½œå’Œä¸“æ³¨æ¥æå‡æŠ€èƒ½ï¼Œè¿½æ±‚ç²¾é€šã€‚", "å·¥ä½œé©¬è™ï¼Œç¼ºä¹é‡å¿ƒï¼ŒåŠé€”è€ŒåºŸã€‚"),
                    9: (["å¯Œè¶³", "ç‹¬ç«‹", "äº«å—æˆæœ"], "äº«å—è¾›å‹¤å·¥ä½œå¸¦æ¥çš„ç‰©è´¨å¯Œè¶³å’Œç‹¬ç«‹ã€‚", "è´¢åŠ¡ä¾èµ–ï¼Œè¿‡åº¦æ¶ˆè´¹ï¼Œç©ºè™šã€‚"),
                    10: (["è´¢å¯Œ", "ä¼ æ‰¿", "å®¶åº­"], "é•¿æœŸçš„ç‰©è´¨æˆåŠŸå’Œå®¶åº­è´¢å¯Œçš„ä¼ æ‰¿ã€‚", "å®¶åº­è´¢åŠ¡çº çº·ï¼Œè´¢å¯ŒæŸå¤±ï¼Œä¸ç¨³å®šã€‚"),
                    "ä¾ä»": (["å­¦ä¹ ", "æœºä¼š", "å‹¤å¥‹"], "æ¸´æœ›å­¦ä¹ æ–°æŠ€èƒ½ï¼Œå¸¦æ¥å®é™…çš„æœºä¼šï¼Œå‹¤å¥‹åŠªåŠ›ã€‚", "æ‡’æƒ°ï¼Œé”™å¤±æœºä¼šï¼Œç¼ºä¹å®è·µã€‚"),
                    "éª‘å£«": (["å¯é ", "è€å¿ƒ", "åŠªåŠ›å·¥ä½œ"], "å¯é ã€æœ‰è€å¿ƒã€åŠªåŠ›å·¥ä½œçš„äººï¼Œè„šè¸å®åœ°ã€‚", "å›ºæ‰§ï¼Œåœæ»ä¸å‰ï¼Œè¿‡äºè¿½æ±‚ç‰©è´¨ã€‚"),
                    "ç‹å": (["æ»‹å…»", "åŠ¡å®", "æ…·æ…¨"], "åŠ¡å®ã€æ…·æ…¨ã€æ‡‚å¾—äº«å—ç”Ÿæ´»çš„å¥³æ€§ï¼Œèƒ½æä¾›ç‰©è´¨æ”¯æŒã€‚", "ç‰©è´¨ä¸»ä¹‰ï¼Œå«‰å¦’ï¼Œè¿‡åº¦å…³æ³¨å¤–è¡¨ã€‚"),
                    "å›½ç‹": (["å¯Œè£•", "æˆåŠŸ", "å¯é "], "æˆåŠŸã€å¯é ã€æ…·æ…¨çš„é¢†å¯¼è€…ï¼Œå–„äºåˆ›é€ å’Œç»´æŠ¤è´¢å¯Œã€‚", "è´ªå©ªï¼Œè…è´¥ï¼Œè¿‡äºä¿å®ˆã€‚")
                }
            }
        }

        court_cards = ["ä¾ä»", "éª‘å£«", "ç‹å", "å›½ç‹"]
        
        for suit, suit_data in minor_arcana_meanings.items():
            suit_name = suit_data["suit_name"]
            suit_desc = suit_data["suit_desc"]
            
            # æ•°å­—ç‰Œ 1-10
            for num in range(1, 11):
                keywords, upright, reversed_mean = suit_data["cards"][num]
                cards.append(TarotCard(
                    name=f"{suit_name}{num}",
                    suit=suit,
                    number=num,
                    keywords=keywords,
                    upright_meaning=upright,
                    reversed_meaning=reversed_mean,
                    description=f"{suit_desc}çš„æ•°å­—ç‰Œ"
                ))
            
            # å®«å»·ç‰Œ
            for court in court_cards:
                keywords, upright, reversed_mean = suit_data["cards"][court]
                cards.append(TarotCard(
                    name=f"{suit_name}{court}",
                    suit=suit,
                    number=None, # å®«å»·ç‰Œæ²¡æœ‰æ•°å­—
                    keywords=keywords,
                    upright_meaning=upright,
                    reversed_meaning=reversed_mean,
                    description=f"{suit_desc}çš„å®«å»·ç‰Œ"
                ))
        
        return cards
    
    def shuffle(self):
        """æ´—ç‰Œ"""
        random.shuffle(self.shuffled_deck)
    
    def draw_card(self) -> TarotCard:
        """æŠ½å–ä¸€å¼ ç‰Œ"""
        if not self.shuffled_deck:
            self.shuffled_deck = self.cards.copy()
            self.shuffle()
        return self.shuffled_deck.pop()
    
    def draw_cards(self, count: int) -> List[TarotCard]:
        """æŠ½å–å¤šå¼ ç‰Œ"""
        return [self.draw_card() for _ in range(count)]

class TarotReading:
    def __init__(self, cards: List[TarotCard], spread_type: str, spread_description: str, question: str = ""):
        self.cards = cards
        self.spread_type = spread_type
        self.spread_description = spread_description
        self.question = question
        self.reversed_cards = [random.choice([True, False]) for _ in cards]
        self.timestamp = datetime.now()
    
    def get_card_meaning(self, index: int) -> str:
        """è·å–æŒ‡å®šä½ç½®ç‰Œçš„å«ä¹‰"""
        card = self.cards[index]
        is_reversed = self.reversed_cards[index]
        
        meaning = card.reversed_meaning if is_reversed else card.upright_meaning
        position = "é€†ä½" if is_reversed else "æ­£ä½"
        
        return f"{card.name} ({position}): {meaning}"
    
    def format_reading(self) -> str:
        """æ ¼å¼åŒ–å åœç»“æœ"""
        result = f"\n=== å¡”ç½—ç‰Œå åœç»“æœ ===\n"
        result += f"æ—¶é—´: {self.timestamp.strftime('%Y-%m-%d %H:%M:%S')}\n"
        result += f"ç‰Œé˜µç±»å‹: {self.spread_type}\n"
        result += f"ç‰Œé˜µè¯´æ˜: {self.spread_description}\n"
        if self.question:
            result += f"é—®é¢˜: {self.question}\n"
        result += f"\næŠ½åˆ°çš„ç‰Œ:\n"
        
        for i, card in enumerate(self.cards):
            position = "é€†ä½" if self.reversed_cards[i] else "æ­£ä½"
            result += f"{i+1}. {card.name} ({position})\n"
        
        return result
    
    def to_dict(self) -> dict:
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ç”¨äºä¿å­˜"""
        return {
            "timestamp": self.timestamp.isoformat(),
            "question": self.question,
            "spread_type": self.spread_type,
            "spread_description": self.spread_description,
            "cards": [
                {
                    "name": card.name,
                    "suit": card.suit.value,
                    "position": "é€†ä½" if self.reversed_cards[i] else "æ­£ä½",
                    "meaning": card.reversed_meaning if self.reversed_cards[i] else card.upright_meaning
                }
                for i, card in enumerate(self.cards)
            ]
        }

class SpreadRecommender:
    """ç‰Œé˜µæ¨èå™¨"""
    
    def __init__(self):
        self.spreads = {
            "single_card": {
                "name": "å•å¼ ç‰ŒæŒ‡å¼•",
                "cards": 1,
                "description": "å¿«é€Ÿè·å¾—å½“ä¸‹æŒ‡å¯¼ï¼Œé€‚åˆæ—¥å¸¸å†³ç­–å’Œç®€å•é—®é¢˜",
                "positions": ["å½“å‰æŒ‡å¼•"]
            },
            "three_card_time": {
                "name": "æ—¶é—´ä¸‰å¼ ç‰Œ",
                "cards": 3,
                "description": "äº†è§£è¿‡å»ã€ç°åœ¨ã€æœªæ¥çš„å‘å±•è¶‹åŠ¿",
                "positions": ["è¿‡å»", "ç°åœ¨", "æœªæ¥"]
            },
            "three_card_situation": {
                "name": "æƒ…å†µä¸‰å¼ ç‰Œ",
                "cards": 3,
                "description": "åˆ†æé—®é¢˜çš„ä¸åŒè§’åº¦",
                "positions": ["æƒ…å†µ", "è¡ŒåŠ¨", "ç»“æœ"]
            },
            "love_relationship": {
                "name": "çˆ±æƒ…å…³ç³»ç‰Œé˜µ",
                "cards": 5,
                "description": "æ·±å…¥äº†è§£æ„Ÿæƒ…çŠ¶å†µå’Œå‘å±•æ–¹å‘",
                "positions": ["ä½ çš„æ„Ÿå—", "å¯¹æ–¹çš„æ„Ÿå—", "å…³ç³»ç°çŠ¶", "æŒ‘æˆ˜", "æœªæ¥å‘å±•"]
            },
            "career_guidance": {
                "name": "äº‹ä¸šæŒ‡å¯¼ç‰Œé˜µ",
                "cards": 6,
                "description": "å…¨é¢åˆ†æèŒä¸šå‘å±•å’Œå·¥ä½œçŠ¶å†µ",
                "positions": ["å½“å‰çŠ¶å†µ", "ä¼˜åŠ¿", "æŒ‘æˆ˜", "æœºä¼š", "å»ºè®®è¡ŒåŠ¨", "æœªæ¥å‰æ™¯"]
            },
            "decision_making": {
                "name": "å†³ç­–åˆ†æç‰Œé˜µ",
                "cards": 7,
                "description": "å¸®åŠ©åšå‡ºé‡è¦å†³å®š",
                "positions": ["å½“å‰æƒ…å†µ", "é€‰æ‹©A", "é€‰æ‹©Aç»“æœ", "é€‰æ‹©B", "é€‰æ‹©Bç»“æœ", "å¤–åœ¨å½±å“", "æœ€ä½³å»ºè®®"]
            },
            "celtic_cross": {
                "name": "å‡¯å°”ç‰¹åå­—",
                "cards": 10,
                "description": "æœ€å…¨é¢çš„ç‰Œé˜µï¼Œæ·±åº¦åˆ†æå¤æ‚é—®é¢˜",
                "positions": ["å½“å‰çŠ¶å†µ", "æŒ‘æˆ˜", "è¿œå› ", "è¿‘å› ", "å¯èƒ½ç»“æœ", "è¿‘æœŸå‘å±•", "ä½ çš„æ€åº¦", "å¤–åœ¨å½±å“", "å†…å¿ƒæœŸæœ›", "æœ€ç»ˆç»“æœ"]
            },
            "year_forecast": {
                "name": "å¹´åº¦è¿åŠ¿",
                "cards": 12,
                "description": "é¢„æµ‹ä¸€å¹´ä¸­æ¯ä¸ªæœˆçš„è¿åŠ¿å‘å±•",
                "positions": [f"{i+1}æœˆ" for i in range(12)]
            }
        }
    
    def get_recommendations(self, question: str) -> List[str]:
        """æ ¹æ®é—®é¢˜æ¨èåˆé€‚çš„ç‰Œé˜µ"""
        prompt = f"""ä½œä¸ºä¸“ä¸šå¡”ç½—ç‰Œå åœå¸ˆï¼Œè¯·æ ¹æ®ä»¥ä¸‹é—®é¢˜æ¨èæœ€åˆé€‚çš„3ä¸ªç‰Œé˜µç±»å‹ã€‚
    
        ç”¨æˆ·é—®é¢˜ï¼š{question}
    
        å¯é€‰ç‰Œé˜µï¼š
        1. å•å¼ ç‰ŒæŒ‡å¼• - å¿«é€Ÿè·å¾—å½“ä¸‹æŒ‡å¯¼ï¼Œé€‚åˆæ—¥å¸¸å†³ç­–å’Œç®€å•é—®é¢˜
        2. æ—¶é—´ä¸‰å¼ ç‰Œ - äº†è§£è¿‡å»ã€ç°åœ¨ã€æœªæ¥çš„å‘å±•è¶‹åŠ¿
        3. æƒ…å†µä¸‰å¼ ç‰Œ - åˆ†æé—®é¢˜çš„ä¸åŒè§’åº¦
        4. çˆ±æƒ…å…³ç³»ç‰Œé˜µ - æ·±å…¥äº†è§£æ„Ÿæƒ…çŠ¶å†µå’Œç›¸å…³æ–¹å‘
        5. äº‹ä¸šæŒ‡å¯¼ç‰Œé˜µ - å…¨é¢åˆ†æèŒä¸šå‘å±•å’Œå·¥ä½œçŠ¶å†µ
        6. å†³ç­–åˆ†æç‰Œé˜µ - å¸®åŠ©åšå‡ºé‡è¦å†³å®š
        7. å‡¯å°”ç‰¹åå­— - æœ€å…¨é¢çš„ç‰Œé˜µï¼Œæ·±åº¦åˆ†æå¤æ‚é—®é¢˜
        8. å¹´åº¦è¿åŠ¿ - é¢„æµ‹ä¸€å¹´ä¸­æ¯ä¸ªæœˆçš„è¿åŠ¿å‘å±•
    
        è¯·æŒ‰ä¼˜å…ˆçº§é¡ºåºæ¨è3ä¸ªæœ€åˆé€‚çš„ç‰Œé˜µï¼Œå¹¶ç®€è¦è¯´æ˜æ¨èç†ç”±ã€‚
        æ ¼å¼ï¼š
        1. [ç‰Œé˜µåç§°] - [æ¨èç†ç”±]
        2. [ç‰Œé˜µåç§°] - [æ¨èç†ç”±]
        3. [ç‰Œé˜µåç§°] - [æ¨èç†ç”±]"""
        
        try:
            response = call_llm(prompt)
            return self._parse_recommendations(response)
        except Exception as e:
            print(f"LLMæ¨èå¤±è´¥: {e}")
            return ["single_card", "three_card_time", "three_card_situation"]
    
    def _parse_recommendations(self, response: str) -> List[str]:
        """è§£æLLMæ¨èç»“æœ"""
        recommendations = []
        name_mapping = {
            "å•å¼ ç‰ŒæŒ‡å¼•": "single_card",
            "æ—¶é—´ä¸‰å¼ ç‰Œ": "three_card_time",
            "æƒ…å†µä¸‰å¼ ç‰Œ": "three_card_situation",
            "çˆ±æƒ…å…³ç³»ç‰Œé˜µ": "love_relationship",
            "äº‹ä¸šæŒ‡å¯¼ç‰Œé˜µ": "career_guidance",
            "å†³ç­–åˆ†æç‰Œé˜µ": "decision_making",
            "å‡¯å°”ç‰¹åå­—": "celtic_cross",
            "å¹´åº¦è¿åŠ¿": "year_forecast"
        }
        
        for name, key in name_mapping.items():
            if name in response:
                recommendations.append(key)
        
        # ç¡®ä¿è‡³å°‘æœ‰3ä¸ªæ¨è
        if len(recommendations) < 3:
            defaults = ["single_card", "three_card_time", "three_card_situation"]
            for default in defaults:
                if default not in recommendations:
                    recommendations.append(default)
                if len(recommendations) >= 3:
                    break
        
        return recommendations[:3]

class LLMTarotInterpreter:
    def __init__(self, model: str = "deepseek/deepseek-chat-v3-0324"):
        self.model = model
    
    def interpret_reading(self, reading: TarotReading) -> str:
        """ä½¿ç”¨LLMè§£è¯»å¡”ç½—ç‰Œ"""
        prompt = self._build_prompt(reading)
        
        try:
            response = call_llm(prompt, model=self.model)
            return response
        except Exception as e:
            return f"æœªèƒ½æˆåŠŸè·å–è§£è¯»ç»“æœ: {str(e)}"
    
    def _get_specialized_prompt_suffix(self, question: str) -> str:
        """æ ¹æ®é—®é¢˜ç±»å‹æ·»åŠ ä¸“é—¨çš„promptåç¼€"""
        question_lower = question.lower()
        
        if any(keyword in question_lower for keyword in ['çˆ±æƒ…', 'æ„Ÿæƒ…', 'æ‹çˆ±', 'å©šå§»', 'å…³ç³»']):
            return """
## ğŸ’• çˆ±æƒ…å…³ç³»ä¸“é¡¹æŒ‡å¯¼
è¯·ç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
- åŒæ–¹çš„æƒ…æ„ŸçŠ¶æ€å’Œéœ€æ±‚
- å…³ç³»å‘å±•çš„è‡ªç„¶èŠ‚å¥
- æ²Ÿé€šå’Œç†è§£çš„é‡è¦æ€§
- ä¸ªäººæˆé•¿å¯¹å…³ç³»çš„å½±å“
- å¦‚ä½•å»ºç«‹æ›´æ·±å±‚çš„è¿æ¥
"""
        
        elif any(keyword in question_lower for keyword in ['å·¥ä½œ', 'äº‹ä¸š', 'èŒä¸š', 'å‡èŒ', 'è·³æ§½']):
            return """
## ğŸ’¼ çš„äº‹ä¸šä¸“é¡¹æŒ‡å¯¼
è¯·ç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
- å½“å‰èŒä¸šçŠ¶æ€çš„è¯„ä¼°
- æŠ€èƒ½å‘å±•å’Œå­¦ä¹ æ–¹å‘
- äººé™…å…³ç³»å’Œå›¢é˜Ÿåˆä½œ
- æœºé‡è¯†åˆ«å’Œé£é™©ç®¡æ§
- é•¿æœŸèŒä¸šè§„åˆ’å»ºè®®
"""
        
        elif any(keyword in question_lower for keyword in ['å†³å®š', 'é€‰æ‹©', 'å†³ç­–']):
            return """
## âš–ï¸ å†³ç­–åˆ†æä¸“é¡¹æŒ‡å¯¼
è¯·ç‰¹åˆ«å…³æ³¨ä»¥ä¸‹æ–¹é¢ï¼š
- å„é€‰é¡¹çš„ä¼˜åŠ£åŠ¿åˆ†æ
- å†³ç­–çš„æ—¶æœºå’Œæ¡ä»¶
- æ½œåœ¨çš„é£é™©å’Œæœºé‡
- å†…å¿ƒçœŸå®çš„æ¸´æœ›
- å†³ç­–åçš„è¡ŒåŠ¨ç­–ç•¥
"""
        
        return ""

    def _build_prompt(self, reading: TarotReading) -> str:
        """æ„å»ºå¢å¼ºç‰ˆLLMæç¤ºè¯"""
        cards_info = []
        # è·å–ç‰Œé˜µçš„ä½ç½®æè¿°
        spread_positions = self.get_spread_positions(reading.spread_type)

        for i, card in enumerate(reading.cards):
            position = "é€†ä½ ğŸ”„" if reading.reversed_cards[i] else "æ­£ä½ â¬†ï¸"
            # ä½¿ç”¨ç‰Œé˜µçš„é¢„è®¾ä½ç½®åç§°ï¼Œå¦‚æœè¶…å‡ºåˆ™ä½¿ç”¨é€šç”¨åç§°
            position_name = spread_positions[i] if i < len(spread_positions) else f"ä½ç½®{i+1}"
            
            element_info = f"({card.suit.value}" + (f", {card.number}å·ç‰Œ" if card.number is not None else ", å®«å»·ç‰Œ") + ")"
            keywords = ", ".join(card.keywords)
            
            cards_info.append(f"""
**{position_name}**: {card.name} {element_info}
- **çŠ¶æ€**: {position}
- **å…³é”®è¯**: {keywords}
- **æ­£ä½å«ä¹‰**: {card.upright_meaning}
- **é€†ä½å«ä¹‰**: {card.reversed_meaning}
""")
        
        specialized_suffix = self._get_specialized_prompt_suffix(reading.question)

        prompt = f"""ä½ æ˜¯ä¸€ä½æ‹¥æœ‰30å¹´ç»éªŒçš„ä¸“ä¸šå¡”ç½—ç‰Œå åœå¸ˆï¼Œç²¾é€šéŸ¦ç‰¹å¡”ç½—ç‰Œç³»ç»Ÿå’Œå„ç§ç‰Œé˜µè§£è¯»ã€‚è¯·ä¸ºä»¥ä¸‹å¡”ç½—ç‰Œå åœæä¾›æ·±å…¥ã€å‡†ç¡®ã€å¯Œæœ‰åŒæƒ…å¿ƒå’Œå»ºè®¾æ€§çš„è§£è¯»ã€‚

## ğŸ“‹ å åœä¿¡æ¯
**é—®é¢˜**: {reading.question if reading.question else 'å¯»æ±‚ä¸€èˆ¬æ€§çš„äººç”ŸæŒ‡å¯¼'}
**ç‰Œé˜µ**: {reading.spread_type}
**ç‰Œé˜µè¯´æ˜**: {reading.spread_description}
**å åœæ—¶é—´**: {reading.timestamp.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S')}

## ğŸƒ æŠ½å–çš„ç‰Œé¢
{''.join(cards_info)}

## ğŸ“– è§£è¯»è¦æ±‚
è¯·æŒ‰ç…§ä»¥ä¸‹ç»“æ„æä¾›ä¸“ä¸šã€è¯¦ç»†çš„è§£è¯»ï¼š

### 1. ğŸ¯ æ•´ä½“èƒ½é‡æ¦‚è§ˆ (Overall Energy)
- **æ ¸å¿ƒä¿¡æ¯**: æ€»ç»“è¿™æ¬¡å åœä¼ è¾¾çš„æœ€æ ¸å¿ƒçš„ä¿¡æ¯å’Œä¸»é¢˜ã€‚
- **èƒ½é‡æµå‘**: åˆ†æç‰Œé¢çš„æ•´ä½“èƒ½é‡æ˜¯ç§¯æçš„ã€æŒ‘æˆ˜çš„è¿˜æ˜¯å¤æ‚çš„ï¼Ÿä¸»å¯¼çš„å…ƒç´ èƒ½é‡ï¼ˆæƒæ–/ç«ã€åœ£æ¯/æ°´ã€å®å‰‘/é£ã€æ˜Ÿå¸/åœŸï¼‰æ˜¯ä»€ä¹ˆï¼Œå®ƒæ­ç¤ºäº†ä»€ä¹ˆï¼Ÿ

### 2. ğŸ” é€å¼ ç‰Œé¢è§£æ (Card-by-Card Analysis)
- æŒ‰ç…§ç‰Œé˜µä¸­æ¯ä¸ªä½ç½®çš„ç‰¹å®šå«ä¹‰ï¼Œæ·±å…¥è§£è¯»å¯¹åº”çš„ç‰Œã€‚
- ç»“åˆç‰Œçš„æ­£ä½/é€†ä½çŠ¶æ€ï¼Œè§£é‡Šå®ƒåœ¨è¯¥ä½ç½®ä¸Šçš„å…·ä½“å½±å“ã€‚
- å°†ç‰Œæ„ä¸é—®åœè€…çš„é—®é¢˜ç´§å¯†è”ç³»èµ·æ¥ã€‚

### 3. ğŸ”— ç‰Œé¢é—´çš„äº’åŠ¨å…³ç³» (Interconnections)
- åˆ†æç‰Œä¸ç‰Œä¹‹é—´æ˜¯å¦‚ä½•ç›¸äº’å½±å“çš„ï¼Œå®ƒä»¬å…±åŒè®²è¿°äº†ä¸€ä¸ªæ€æ ·çš„æ•…äº‹ï¼Ÿ
- è¯†åˆ«å‡ºå…³é”®çš„ç‰Œé¢ç»„åˆï¼ˆä¾‹å¦‚ï¼Œè¿ç»­å‡ºç°çš„å¤§é˜¿å¡çº³ï¼Œæˆ–æŸä¸ªå…ƒç´ å ä¸»å¯¼ï¼‰ã€‚
- æŒ‡å‡ºèƒ½é‡çš„æµåŠ¨ã€å†²çªæˆ–åŠ å¼ºä¹‹å¤„ã€‚

### 4. ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿä¸è¡ŒåŠ¨å»ºè®® (Key Insights & Actionable Advice)
- **æ ¸å¿ƒæ´å¯Ÿ**: æç‚¼å‡ºæœ€é‡è¦çš„æ´å¯Ÿï¼Œå¸®åŠ©é—®åœè€…ç†è§£å½“å‰å±€é¢çš„æœ¬è´¨ã€‚
- **è¡ŒåŠ¨å»ºè®®**: æä¾›æ¸…æ™°ã€å…·ä½“ã€å¯è¡Œçš„è¡ŒåŠ¨æ­¥éª¤ã€‚åº”è¯¥åšä»€ä¹ˆï¼Ÿé¿å…ä»€ä¹ˆï¼Ÿ
- **å¿ƒæ€è°ƒæ•´**: å»ºè®®é—®åœè€…åº”è¯¥é‡‡å–ä½•ç§å¿ƒæ€æ¥é¢å¯¹å½“å‰çŠ¶å†µã€‚

### 5. ğŸŒŸ æ€»ç»“ä¸ç²¾ç¥æŒ‡å¼• (Summary & Spiritual Guidance)
- **æ€»ç»“**: ç”¨å‡ å¥é¼“åŠ±äººå¿ƒçš„è¯æ€»ç»“è¿™æ¬¡å åœçš„æœ€ç»ˆæŒ‡å¼•ã€‚
- **ç²¾ç¥æŒ‡å¼•**: ä»æ›´é«˜çš„ç²¾ç¥å±‚é¢ï¼Œæç‚¼å‡ºè¿™æ¬¡ç»å†å¯¹é—®åœè€…ä¸ªäººæˆé•¿çš„æ„ä¹‰ã€‚
{specialized_suffix}
## ğŸ“ è§£è¯»é£æ ¼è¦æ±‚
- **è¯­è°ƒ**: æ¸©å’Œã€æ™ºæ…§ã€å¯Œæœ‰åŒæƒ…å¿ƒä¸”å……æ»¡é¼“åŠ±ã€‚
- **è§†è§’**: é¿å…å®¿å‘½è®ºï¼Œå¼ºè°ƒä¸ªäººè‡ªç”±æ„å¿—å’Œé€‰æ‹©çš„åŠ›é‡ã€‚å°†å¡”ç½—ç‰Œè§†ä¸ºä¸€é¢é•œå­å’Œä¸€ä»½æŒ‡å¼•ï¼Œè€Œéç»å¯¹çš„é¢„è¨€ã€‚
- **é‡ç‚¹**: èšç„¦äºæä¾›å»ºè®¾æ€§çš„è§£å†³æ–¹æ¡ˆå’Œç§¯æçš„æˆé•¿è·¯å¾„ã€‚

è¯·å¼€å§‹æ‚¨çš„ä¸“ä¸šè§£è¯»ï¼š"""
        
        return prompt

    def get_spread_positions(self, spread_type: str) -> list[str]:
        """è·å–æŒ‡å®šç‰Œé˜µçš„ä½ç½®åç§°"""
        # è¿™ä¸ªæ–¹æ³•éœ€è¦è®¿é—®SpreadRecommenderä¸­çš„ç‰Œé˜µå®šä¹‰
        # ä¸ºäº†è§£è€¦ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç¡¬ç¼–ç ä¸€ä¸ªæ˜ å°„ï¼Œç†æƒ³æƒ…å†µä¸‹å¯ä»¥é‡æ„
        spreads = {
            "single_card": ["å½“å‰æŒ‡å¼•"],
            "three_card_time": ["è¿‡å»", "ç°åœ¨", "æœªæ¥"],
            "three_card_situation": ["æƒ…å†µ", "è¡ŒåŠ¨", "ç»“æœ"],
            "love_relationship": ["ä½ çš„æ„Ÿå—", "å¯¹æ–¹çš„æ„Ÿå—", "å…³ç³»ç°çŠ¶", "æŒ‘æˆ˜", "æœªæ¥å‘å±•"],
            "career_guidance": ["å½“å‰çŠ¶å†µ", "ä¼˜åŠ¿", "æŒ‘æˆ˜", "æœºä¼š", "å»ºè®®è¡ŒåŠ¨", "æœªæ¥å‰æ™¯"],
            "decision_making": ["å½“å‰æƒ…å†µ", "é€‰æ‹©A", "é€‰æ‹©Aç»“æœ", "é€‰æ‹©B", "é€‰æ‹©Bç»“æœ", "å¤–åœ¨å½±å“", "æœ€ä½³å»ºè®®"],
            "celtic_cross": ["å½“å‰çŠ¶å†µ", "æŒ‘æˆ˜", "è¿œå› ", "è¿‘å› ", "å¯èƒ½ç»“æœ", "è¿‘æœŸå‘å±•", "ä½ çš„æ€åº¦", "å¤–åœ¨å½±å“", "å†…å¿ƒæœŸæœ›", "æœ€ç»ˆç»“æœ"],
            "year_forecast": [f"{i+1}æœˆ" for i in range(12)]
        }
        return spreads.get(spread_type, [])

class ResultSaver:
    """ç»“æœä¿å­˜å™¨"""
    
    def __init__(self, save_dir: str = "answers"):
        self.save_dir = save_dir
        self._ensure_dir_exists()
    
    def _ensure_dir_exists(self):
        """ç¡®ä¿ä¿å­˜ç›®å½•å­˜åœ¨"""
        if not os.path.exists(self.save_dir):
            os.makedirs(self.save_dir)
    
    def save_reading(self, reading: TarotReading, interpretation: str = "") -> str:
        """ä¿å­˜å åœç»“æœ"""
        timestamp = reading.timestamp.strftime("%Y%m%d_%H%M%S")
        
        # ä¿å­˜JSONæ ¼å¼ï¼ˆç”¨äºç¨‹åºå¤„ç†ï¼‰
        json_filename = f"tarot_reading_{timestamp}.json"
        json_filepath = os.path.join(self.save_dir, json_filename)
        
        # ä¿å­˜ç¾è§‚çš„æ–‡æœ¬æ ¼å¼ï¼ˆç”¨äºç”¨æˆ·é˜…è¯»ï¼‰
        txt_filename = f"tarot_reading_{timestamp}.txt"
        txt_filepath = os.path.join(self.save_dir, txt_filename)
        
        try:
            # ä¿å­˜JSONæ ¼å¼
            data = reading.to_dict()
            data["interpretation"] = interpretation
            
            with open(json_filepath, 'w', encoding='utf-8') as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
            
            # ä¿å­˜ç¾è§‚çš„æ–‡æœ¬æ ¼å¼
            formatted_report = self._generate_beautiful_report(reading, interpretation)
            with open(txt_filepath, 'w', encoding='utf-8') as f:
                f.write(formatted_report)
            
            return txt_filepath  # è¿”å›æ–‡æœ¬æ–‡ä»¶è·¯å¾„
            
        except Exception as e:
            print(f"ä¿å­˜å¤±è´¥: {e}")
            return ""
    
    def _generate_beautiful_report(self, reading: TarotReading, interpretation: str) -> str:
        """ç”Ÿæˆç¾è§‚çš„æ–‡æœ¬æŠ¥å‘Š"""
        report = []
        
        # æ ‡é¢˜å’Œåˆ†éš”çº¿
        report.append("ğŸ”®" + "="*60 + "ğŸ”®")
        report.append("                    å¡”ç½—ç‰Œå åœæŠ¥å‘Š")
        report.append("ğŸ”®" + "="*60 + "ğŸ”®")
        report.append("")
        
        # åŸºæœ¬ä¿¡æ¯
        report.append("ğŸ“… å åœæ—¶é—´: " + reading.timestamp.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S"))
        report.append("â“ å åœé—®é¢˜: " + (reading.question or "ä¸€èˆ¬æ€§æŒ‡å¯¼"))
        report.append("ğŸ¯ ä½¿ç”¨ç‰Œé˜µ: " + reading.spread_type)
        report.append("ğŸ“ ç‰Œé˜µè¯´æ˜: " + reading.spread_description)
        report.append("")
        
        # æŠ½ç‰Œç»“æœ
        report.append("ğŸƒ" + "-"*58 + "ğŸƒ")
        report.append("                      æŠ½ç‰Œç»“æœ")
        report.append("ğŸƒ" + "-"*58 + "ğŸƒ")
        report.append("")
        
        for i, card in enumerate(reading.cards, 1):
            position_desc = "é€†ä½ ğŸ”„" if reading.reversed_cards[i-1] else "æ­£ä½ â¬†ï¸"
            meaning = card.reversed_meaning if reading.reversed_cards[i-1] else card.upright_meaning
            
            report.append(f"ç¬¬{i}å¼ ç‰Œ: {card.name} ({card.suit.value})")
            report.append(f"  çŠ¶æ€: {position_desc}")
            report.append(f"  å«ä¹‰: {meaning}")
            report.append("")
        
        # AIè§£è¯»éƒ¨åˆ†
        if interpretation:
            report.append("ğŸ¤–" + "-"*58 + "ğŸ¤–")
            report.append("                      AI æ·±åº¦è§£è¯»")
            report.append("ğŸ¤–" + "-"*58 + "ğŸ¤–")
            report.append("")
            
            # å¤„ç†è§£è¯»æ–‡æœ¬ï¼Œä¿æŒåŸæœ‰çš„markdownæ ¼å¼ä½†å¢åŠ å¯è¯»æ€§
            interpretation_lines = interpretation.split('\n')
            for line in interpretation_lines:
                if line.strip():
                    report.append(line)
                else:
                    report.append("")
        
        # ç»“å°¾
        report.append("")
        report.append("âœ¨" + "="*58 + "âœ¨")
        report.append("                 æ„¿æ™ºæ…§ä¸æ‚¨åŒåœ¨")
        report.append("âœ¨" + "="*58 + "âœ¨")
        
        return "\n".join(report)

class TarotApp:
    def __init__(self):
        self.deck = TarotDeck()
        self.interpreter = LLMTarotInterpreter()
        self.recommender = SpreadRecommender()
        self.saver = ResultSaver()
    
    def run(self):
        """è¿è¡Œå¡”ç½—ç‰Œç¨‹åº"""
        print("ğŸ”® æ¬¢è¿æ¥åˆ°æ™ºèƒ½å¡”ç½—ç‰Œå åœä¸–ç•Œ ğŸ”®")
        print("="*50)
        
        while True:
            try:
                if not self._main_flow():
                    break
            except KeyboardInterrupt:
                print("\n\næ„Ÿè°¢ä½¿ç”¨ï¼Œæ„¿æ™ºæ…§ä¸æ‚¨åŒåœ¨ âœ¨")
                break
            except Exception as e:
                print(f"âŒ å‘ç”Ÿé”™è¯¯: {str(e)}")
    
    def _main_flow(self) -> bool:
        """ä¸»è¦æµç¨‹"""
        print("\n" + "="*50)
        print("ğŸŒŸ å¼€å§‹æ–°çš„å¡”ç½—ç‰Œå åœ")
        
        # 1. è·å–é—®é¢˜
        question = self._get_question()
        if question.lower() in ['quit', 'exit', 'é€€å‡º', 'q']:
            print("æ„Ÿè°¢ä½¿ç”¨å¡”ç½—ç‰Œå åœç¨‹åºï¼æ„¿æ™ºæ…§ä¸æ‚¨åŒåœ¨ âœ¨")
            return False
        
        # 2. LLMæ¨èç‰Œé˜µ
        print("\nğŸ¤– AIæ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜å¹¶æ¨èåˆé€‚çš„ç‰Œé˜µ...")
        recommended_spreads = self._get_spread_recommendations(question)
        
        # 3. ç”¨æˆ·é€‰æ‹©ç‰Œé˜µ
        selected_spread = self._select_spread(recommended_spreads)
        if not selected_spread:
            return True
        
        # 4. æ‰§è¡Œå åœ
        reading = self._perform_reading(question, selected_spread)
        
        # 5. LLMè§£è¯»
        interpretation = self._get_interpretation(reading)
        
        # 6. ä¿å­˜ç»“æœ
        self._save_results(reading, interpretation)
        
        # 7. è¯¢é—®æ˜¯å¦ç»§ç»­
        return self._ask_continue()
    
    def _get_question(self) -> str:
        """è·å–ç”¨æˆ·é—®é¢˜"""
        print("\nğŸ’­ è¯·è¾“å…¥æ‚¨æƒ³è¦å åœçš„é—®é¢˜ï¼š")
        print("ï¼ˆå¯ä»¥æ˜¯å…³äºçˆ±æƒ…ã€äº‹ä¸šã€äººé™…å…³ç³»ã€å†³ç­–ç­‰ä»»ä½•æ–¹é¢ï¼‰")
        print("ï¼ˆè¾“å…¥ 'quit' æˆ– 'exit' é€€å‡ºç¨‹åºï¼‰")
        
        question = input("\næ‚¨çš„é—®é¢˜: ").strip()
        
        if not question:
            question = "è¯·ä¸ºæˆ‘æä¾›å½“ä¸‹çš„æŒ‡å¯¼"
            print(f"ä½¿ç”¨é»˜è®¤é—®é¢˜: {question}")
        
        return question
    
    def _get_spread_recommendations(self, question: str) -> List[str]:
        """è·å–ç‰Œé˜µæ¨è"""
        try:
            return self.recommender.get_recommendations(question)
        except Exception as e:
            print(f"æ¨èç³»ç»Ÿå‡ºé”™: {e}")
            return ["single_card", "three_card_time", "three_card_situation"]
    
    def _select_spread(self, recommended_spreads: List[str]) -> Optional[str]:
        """é€‰æ‹©ç‰Œé˜µ"""
        print("\nğŸ¯ æ ¹æ®æ‚¨çš„é—®é¢˜ï¼ŒAIæ¨èä»¥ä¸‹ç‰Œé˜µï¼š")
        print("="*40)
        
        # æ˜¾ç¤ºæ¨èçš„ç‰Œé˜µ
        for i, spread_key in enumerate(recommended_spreads, 1):
            spread = self.recommender.spreads[spread_key]
            print(f"{i}. {spread['name']} ({spread['cards']}å¼ ç‰Œ) â­")
            print(f"   {spread['description']}")
            print()
        
        # æ˜¾ç¤ºæ‰€æœ‰ç‰Œé˜µçš„å®Œæ•´åˆ—è¡¨
        print("\nğŸ“‹ æ‰€æœ‰å¯é€‰ç‰Œé˜µï¼š")
        all_spreads = list(self.recommender.spreads.keys())
        
        for i, spread_key in enumerate(all_spreads, 1):
            spread = self.recommender.spreads[spread_key]
            star = " â­" if spread_key in recommended_spreads else ""
            print(f"{i}. {spread['name']} ({spread['cards']}å¼ ç‰Œ){star}")
        
        print("\n0. è¿”å›ä¸»èœå•")
        
        while True:
            try:
                choice = input("\nè¯·é€‰æ‹©ç‰Œé˜µ (è¾“å…¥æ•°å­—): ").strip()
                
                if choice == "0":
                    return None
                
                choice_num = int(choice)
                
                if 1 <= choice_num <= len(all_spreads):
                    return all_spreads[choice_num - 1]
                else:
                    print("âŒ æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥")
                    
            except ValueError:
                print("âŒ è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—")
    
    def _perform_reading(self, question: str, spread_key: str) -> TarotReading:
        """æ‰§è¡Œå åœ"""
        spread = self.recommender.spreads[spread_key]
        
        print(f"\nğŸ”® å¼€å§‹ {spread['name']} å åœ")
        print(f"ç‰Œé˜µè¯´æ˜: {spread['description']}")
        
        print("\nğŸŒŸ æ­£åœ¨æ´—ç‰Œ...")
        self.deck.shuffle()
        
        print("âœ¨ æ­£åœ¨æŠ½ç‰Œ...")
        cards = self.deck.draw_cards(spread['cards'])
        
        reading = TarotReading(
            cards=cards,
            spread_type=spread['name'],
            spread_description=spread['description'],
            question=question
        )
        
        # æ˜¾ç¤ºæŠ½ç‰Œç»“æœ
        print(reading.format_reading())
        
        # æ˜¾ç¤ºç‰Œé˜µä½ç½®è¯´æ˜
        if 'positions' in spread:
            print("\nğŸ“ ç‰Œé˜µä½ç½®è¯´æ˜:")
            for i, position in enumerate(spread['positions']):
                card = cards[i]
                position_desc = "é€†ä½" if reading.reversed_cards[i] else "æ­£ä½"
                print(f"{i+1}. {position}: {card.name} ({position_desc})")
        
        return reading
    
    def _get_interpretation(self, reading: TarotReading) -> str:
        """è·å–è§£è¯»"""
        if input("\nğŸ¤– æ˜¯å¦éœ€è¦AIè¯¦ç»†è§£è¯»ï¼Ÿ(y/n): ").lower().startswith('y'):
            print("\nğŸ” AIæ­£åœ¨æ·±åº¦è§£è¯»ä¸­ï¼Œè¯·ç¨å€™...")
            interpretation = self.interpreter.interpret_reading(reading)
            print("\n" + "="*50)
            print("ğŸ­ AIå¡”ç½—ç‰Œè§£è¯»")
            print("="*50)
            print(interpretation)
            return interpretation
        return ""
    
    def _save_results(self, reading: TarotReading, interpretation: str):
        """ä¿å­˜ç»“æœ"""
        filepath = self.saver.save_reading(reading, interpretation)
        if filepath:
            print(f"\nğŸ’¾ å åœç»“æœå·²ä¿å­˜åˆ°: {filepath}")
            
            # è¯¢é—®æ˜¯å¦ç«‹å³æŸ¥çœ‹æŠ¥å‘Š
            if input("\nğŸ“– æ˜¯å¦ç«‹å³æŸ¥çœ‹å®Œæ•´æŠ¥å‘Šï¼Ÿ(y/n): ").lower().startswith('y'):
                try:
                    with open(filepath, 'r', encoding='utf-8') as f:
                        content = f.read()
                    print("\n" + "="*80)
                    print(content)
                    print("="*80)
                except Exception as e:
                    print(f"è¯»å–æŠ¥å‘Šå¤±è´¥: {e}")
    
    def _ask_continue(self) -> bool:
        """è¯¢é—®æ˜¯å¦ç»§ç»­"""
        print("\n" + "="*50)
        continue_choice = input("æ˜¯å¦ç»§ç»­æ–°çš„å åœï¼Ÿ(y/n): ").lower()
        return continue_choice.startswith('y')

def get_all_spreads(self):
    """è·å–æ‰€æœ‰å¯ç”¨çš„ç‰Œé˜µ"""
    return self.spreads

def main():
    """ä¸»å‡½æ•°"""
    app = TarotApp()
    app.run()

if __name__ == "__main__":
    main()

